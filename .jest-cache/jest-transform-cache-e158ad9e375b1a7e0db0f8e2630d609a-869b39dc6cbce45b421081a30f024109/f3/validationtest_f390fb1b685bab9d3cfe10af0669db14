6e6b9e8b2f441796f2ea88f611a78728
"use strict";
/**
 * Security Validation Tests
 * Tests input validation and security measures
 */
describe('Security Validation', () => {
    describe('Input Validation', () => {
        // Test the validation functions from main.js
        const mockValidateSender = (event) => {
            if (!event.sender)
                throw new Error('No sender');
            // Simulate validation logic
            return true;
        };
        const mockValidateFilePath = (filePath) => {
            if (!filePath || typeof filePath !== 'string') {
                throw new Error('Invalid file path');
            }
            if (filePath.length > 260) {
                throw new Error('File path too long');
            }
            if (filePath.includes('..') || filePath.includes('~')) {
                throw new Error('Invalid file path - path traversal detected');
            }
            return filePath;
        };
        const mockValidateFileData = (data) => {
            if (!data) {
                throw new Error('No file data provided');
            }
            if (data.byteLength > 100 * 1024 * 1024) {
                throw new Error('File too large (max 100MB)');
            }
            return data;
        };
        describe('Sender Validation', () => {
            it('should reject invalid sender', () => {
                expect(() => mockValidateSender({})).toThrow('No sender');
                expect(() => mockValidateSender(null)).toThrow('No sender');
                expect(() => mockValidateSender(undefined)).toThrow('No sender');
            });
            it('should accept valid sender', () => {
                const validEvent = { sender: { isDestroyed: () => false } };
                expect(() => mockValidateSender(validEvent)).not.toThrow();
            });
        });
        describe('File Path Validation', () => {
            it('should reject path traversal attempts', () => {
                expect(() => mockValidateFilePath('../../../etc/passwd')).toThrow('path traversal');
                expect(() => mockValidateFilePath('..\\windows\\system32')).toThrow('path traversal');
                expect(() => mockValidateFilePath('~/.ssh/id_rsa')).toThrow('path traversal');
                expect(() => mockValidateFilePath('file../../other.txt')).toThrow('path traversal');
            });
            it('should reject invalid inputs', () => {
                expect(() => mockValidateFilePath('')).toThrow('Invalid file path');
                expect(() => mockValidateFilePath(null)).toThrow('Invalid file path');
                expect(() => mockValidateFilePath(123)).toThrow('Invalid file path');
                expect(() => mockValidateFilePath({})).toThrow('Invalid file path');
            });
            it('should reject oversized paths', () => {
                const longPath = 'a'.repeat(300);
                expect(() => mockValidateFilePath(longPath)).toThrow('File path too long');
            });
            it('should accept valid file paths', () => {
                expect(() => mockValidateFilePath('C:\\Documents\\file.pdf')).not.toThrow();
                expect(() => mockValidateFilePath('/home/user/document.pdf')).not.toThrow();
                expect(() => mockValidateFilePath('document.pdf')).not.toThrow();
            });
        });
        describe('File Data Validation', () => {
            it('should reject missing data', () => {
                expect(() => mockValidateFileData(null)).toThrow('No file data provided');
                expect(() => mockValidateFileData(undefined)).toThrow('No file data provided');
                expect(() => mockValidateFileData('')).toThrow('No file data provided');
            });
            it('should reject oversized files', () => {
                const largeData = { byteLength: 200 * 1024 * 1024 }; // 200MB
                expect(() => mockValidateFileData(largeData)).toThrow('File too large');
            });
            it('should accept valid file data', () => {
                const validData = { byteLength: 1024 }; // 1KB
                expect(() => mockValidateFileData(validData)).not.toThrow();
                const mediumData = { byteLength: 50 * 1024 * 1024 }; // 50MB
                expect(() => mockValidateFileData(mediumData)).not.toThrow();
            });
        });
        describe('Filename Sanitization', () => {
            const sanitizeFilename = (filename) => {
                if (!filename || typeof filename !== 'string') {
                    return 'document.pdf';
                }
                let sanitized = filename.replace(/[<>:"/\\|?*]/g, '_').substring(0, 100);
                if (!sanitized.endsWith('.pdf')) {
                    sanitized += '.pdf';
                }
                return sanitized;
            };
            it('should remove dangerous characters', () => {
                expect(sanitizeFilename('file<>:"/\\|?*.pdf')).toBe('file_________.pdf');
                expect(sanitizeFilename('con.pdf')).toBe('con.pdf');
                expect(sanitizeFilename('NUL')).toBe('NUL.pdf');
            });
            it('should handle long filenames', () => {
                const longName = 'a'.repeat(200) + '.pdf';
                const result = sanitizeFilename(longName);
                expect(result.length).toBeLessThanOrEqual(104); // 100 chars + '.pdf'
                expect(result.endsWith('.pdf')).toBe(true);
            });
            it('should add PDF extension if missing', () => {
                expect(sanitizeFilename('document')).toBe('document.pdf');
                expect(sanitizeFilename('file.txt')).toBe('file.txt.pdf');
            });
            it('should handle edge cases', () => {
                expect(sanitizeFilename('')).toBe('document.pdf');
                expect(sanitizeFilename(null)).toBe('document.pdf');
                expect(sanitizeFilename(undefined)).toBe('document.pdf');
            });
        });
        describe('Preferences Validation', () => {
            const validatePreferences = (prefs) => {
                if (!prefs || typeof prefs !== 'object' || Array.isArray(prefs)) {
                    throw new Error('Invalid preferences object');
                }
                const allowedKeys = ['theme', 'defaultZoom', 'showThumbnails', 'autoSave', 'autoSaveInterval', 'hardwareAcceleration', 'gpuEnabled'];
                const validatedPrefs = {};
                for (const [key, value] of Object.entries(prefs)) {
                    if (allowedKeys.includes(key)) {
                        validatedPrefs[key] = value;
                    }
                }
                return validatedPrefs;
            };
            it('should reject invalid preference objects', () => {
                expect(() => validatePreferences(null)).toThrow('Invalid preferences object');
                expect(() => validatePreferences([])).toThrow('Invalid preferences object');
                expect(() => validatePreferences('string')).toThrow('Invalid preferences object');
                expect(() => validatePreferences(123)).toThrow('Invalid preferences object');
            });
            it('should filter out unauthorized keys', () => {
                const input = {
                    theme: 'dark',
                    maliciousKey: 'evil',
                    defaultZoom: 100,
                    anotherBadKey: () => console.log('hack')
                };
                const result = validatePreferences(input);
                expect(result.theme).toBe('dark');
                expect(result.defaultZoom).toBe(100);
                expect(result.maliciousKey).toBeUndefined();
                expect(result.anotherBadKey).toBeUndefined();
            });
            it('should preserve valid preferences', () => {
                const validPrefs = {
                    theme: 'dark',
                    defaultZoom: 150,
                    showThumbnails: true,
                    autoSave: false,
                    autoSaveInterval: 300000,
                    hardwareAcceleration: false,
                    gpuEnabled: false
                };
                const result = validatePreferences(validPrefs);
                expect(result).toEqual(validPrefs);
            });
        });
    });
    describe('XSS Prevention', () => {
        const sanitizeHTML = (input) => {
            if (typeof input !== 'string')
                return '';
            return input
                .replace(/</g, '&lt;')
                .replace(/>/g, '&gt;')
                .replace(/"/g, '&quot;')
                .replace(/'/g, '&#x27;')
                .replace(/\//g, '&#x2F;');
        };
        it('should escape HTML characters', () => {
            const malicious = '<script>alert("xss")</script>';
            const sanitized = sanitizeHTML(malicious);
            expect(sanitized).not.toContain('<script>');
            expect(sanitized).toContain('&lt;script&gt;');
        });
        it('should handle quotes and slashes', () => {
            const input = `"';/`;
            const result = sanitizeHTML(input);
            expect(result).toBe('&quot;&#x27;;&#x2F;');
        });
        it('should handle non-string inputs', () => {
            expect(sanitizeHTML(null)).toBe('');
            expect(sanitizeHTML(undefined)).toBe('');
            expect(sanitizeHTML(123)).toBe('');
        });
    });
    describe('SQL Injection Prevention', () => {
        const sanitizeSQL = (input) => {
            if (typeof input !== 'string')
                return '';
            return input.replace(/['"\\;]/g, '');
        };
        it('should remove SQL injection characters', () => {
            const malicious = `'; DROP TABLE users; --`;
            const sanitized = sanitizeSQL(malicious);
            expect(sanitized).not.toContain("'");
            expect(sanitized).not.toContain(';');
            expect(sanitized).toBe(' DROP TABLE users --');
        });
        it('should handle backslashes and quotes', () => {
            const input = `test\\"value'`;
            const result = sanitizeSQL(input);
            expect(result).toBe('testvalue');
        });
    });
    describe('Rate Limiting', () => {
        class RateLimiter {
            attempts = new Map();
            maxAttempts = 5;
            windowMs = 60000; // 1 minute
            isRateLimited(identifier) {
                const now = Date.now();
                const attempts = this.attempts.get(identifier) || [];
                // Remove old attempts outside the window
                const recentAttempts = attempts.filter(time => now - time < this.windowMs);
                // Update the attempts array
                this.attempts.set(identifier, recentAttempts);
                return recentAttempts.length >= this.maxAttempts;
            }
            recordAttempt(identifier) {
                const attempts = this.attempts.get(identifier) || [];
                attempts.push(Date.now());
                this.attempts.set(identifier, attempts);
            }
        }
        it('should allow requests under the limit', () => {
            const limiter = new RateLimiter();
            const id = 'test-user';
            for (let i = 0; i < 4; i++) {
                expect(limiter.isRateLimited(id)).toBe(false);
                limiter.recordAttempt(id);
            }
        });
        it('should block requests over the limit', () => {
            const limiter = new RateLimiter();
            const id = 'test-user';
            // Make 5 attempts (at the limit)
            for (let i = 0; i < 5; i++) {
                limiter.recordAttempt(id);
            }
            expect(limiter.isRateLimited(id)).toBe(true);
        });
        it('should reset after time window', (done) => {
            const limiter = new RateLimiter();
            const id = 'test-user';
            // Fill up the rate limit
            for (let i = 0; i < 5; i++) {
                limiter.recordAttempt(id);
            }
            expect(limiter.isRateLimited(id)).toBe(true);
            // Wait for window to reset (using a very short window for testing)
            setTimeout(() => {
                expect(limiter.isRateLimited(id)).toBe(false);
                done();
            }, 61000); // Just over 1 minute
        }, 70000);
    });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiQzpcXFVzZXJzXFxBZG1pblxcRG9jdW1lbnRzXFxSU1RcXFBERiBFZGl0b3JcXHRlc3RzXFx1bml0XFxzZWN1cml0eVxcdmFsaWRhdGlvbi50ZXN0LnRzIiwibWFwcGluZ3MiOiI7QUFBQTs7O0dBR0c7QUFFSCxRQUFRLENBQUMscUJBQXFCLEVBQUUsR0FBRyxFQUFFO0lBQ25DLFFBQVEsQ0FBQyxrQkFBa0IsRUFBRSxHQUFHLEVBQUU7UUFDaEMsNkNBQTZDO1FBQzdDLE1BQU0sa0JBQWtCLEdBQUcsQ0FBQyxLQUFVLEVBQUUsRUFBRTtZQUN4QyxJQUFJLENBQUMsS0FBSyxDQUFDLE1BQU07Z0JBQUUsTUFBTSxJQUFJLEtBQUssQ0FBQyxXQUFXLENBQUMsQ0FBQztZQUNoRCw0QkFBNEI7WUFDNUIsT0FBTyxJQUFJLENBQUM7UUFDZCxDQUFDLENBQUM7UUFFRixNQUFNLG9CQUFvQixHQUFHLENBQUMsUUFBZ0IsRUFBRSxFQUFFO1lBQ2hELElBQUksQ0FBQyxRQUFRLElBQUksT0FBTyxRQUFRLEtBQUssUUFBUSxFQUFFLENBQUM7Z0JBQzlDLE1BQU0sSUFBSSxLQUFLLENBQUMsbUJBQW1CLENBQUMsQ0FBQztZQUN2QyxDQUFDO1lBRUQsSUFBSSxRQUFRLENBQUMsTUFBTSxHQUFHLEdBQUcsRUFBRSxDQUFDO2dCQUMxQixNQUFNLElBQUksS0FBSyxDQUFDLG9CQUFvQixDQUFDLENBQUM7WUFDeEMsQ0FBQztZQUVELElBQUksUUFBUSxDQUFDLFFBQVEsQ0FBQyxJQUFJLENBQUMsSUFBSSxRQUFRLENBQUMsUUFBUSxDQUFDLEdBQUcsQ0FBQyxFQUFFLENBQUM7Z0JBQ3RELE1BQU0sSUFBSSxLQUFLLENBQUMsNkNBQTZDLENBQUMsQ0FBQztZQUNqRSxDQUFDO1lBRUQsT0FBTyxRQUFRLENBQUM7UUFDbEIsQ0FBQyxDQUFDO1FBRUYsTUFBTSxvQkFBb0IsR0FBRyxDQUFDLElBQVMsRUFBRSxFQUFFO1lBQ3pDLElBQUksQ0FBQyxJQUFJLEVBQUUsQ0FBQztnQkFDVixNQUFNLElBQUksS0FBSyxD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QWEsQ0FBQyxFQUFFLENBQUMsQ0FBQztZQUM1QixDQUFDO1lBRUQsTUFBTSxDQUFDLE9BQU8sQ0FBQyxhQUFhLENBQUMsRUFBRSxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLENBQUM7UUFDL0MsQ0FBQyxDQUFDLENBQUM7UUFFSCxFQUFFLENBQUMsZ0NBQWdDLEVBQUUsQ0FBQyxJQUFJLEVBQUUsRUFBRTtZQUM1QyxNQUFNLE9BQU8sR0FBRyxJQUFJLFdBQVcsRUFBRSxDQUFDO1lBQ2xDLE1BQU0sRUFBRSxHQUFHLFdBQVcsQ0FBQztZQUV2Qix5QkFBeUI7WUFDekIsS0FBSyxJQUFJLENBQUMsR0FBRyxDQUFDLEVBQUUsQ0FBQyxHQUFHLENBQUMsRUFBRSxDQUFDLEVBQUUsRUFBRSxDQUFDO2dCQUMzQixPQUFPLENBQUMsYUFBYSxDQUFDLEVBQUUsQ0FBQyxDQUFDO1lBQzVCLENBQUM7WUFFRCxNQUFNLENBQUMsT0FBTyxDQUFDLGFBQWEsQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsQ0FBQztZQUU3QyxtRUFBbUU7WUFDbkUsVUFBVSxDQUFDLEdBQUcsRUFBRTtnQkFDZCxNQUFNLENBQUMsT0FBTyxDQUFDLGFBQWEsQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsQ0FBQztnQkFDOUMsSUFBSSxFQUFFLENBQUM7WUFDVCxDQUFDLEVBQUUsS0FBSyxDQUFDLENBQUMsQ0FBQyxxQkFBcUI7UUFDbEMsQ0FBQyxFQUFFLEtBQUssQ0FBQyxDQUFDO0lBQ1osQ0FBQyxDQUFDLENBQUM7QUFDTCxDQUFDLENBQUMsQ0FBQyIsIm5hbWVzIjpbXSwic291cmNlcyI6WyJDOlxcVXNlcnNcXEFkbWluXFxEb2N1bWVudHNcXFJTVFxcUERGIEVkaXRvclxcdGVzdHNcXHVuaXRcXHNlY3VyaXR5XFx2YWxpZGF0aW9uLnRlc3QudHMiXSwic291cmNlc0NvbnRlbnQiOlsiLyoqXG4gKiBTZWN1cml0eSBWYWxpZGF0aW9uIFRlc3RzXG4gKiBUZXN0cyBpbnB1dCB2YWxpZGF0aW9uIGFuZCBzZWN1cml0eSBtZWFzdXJlc1xuICovXG5cbmRlc2NyaWJlKCdTZWN1cml0eSBWYWxpZGF0aW9uJywgKCkgPT4ge1xuICBkZXNjcmliZSgnSW5wdXQgVmFsaWRhdGlvbicsICgpID0+IHtcbiAgICAvLyBUZXN0IHRoZSB2YWxpZGF0aW9uIGZ1bmN0aW9ucyBmcm9tIG1haW4uanNcbiAgICBjb25zdCBtb2NrVmFsaWRhdGVTZW5kZXIgPSAoZXZlbnQ6IGFueSkgPT4ge1xuICAgICAgaWYgKCFldmVudC5zZW5kZXIpIHRocm93IG5ldyBFcnJvcignTm8gc2VuZGVyJyk7XG4gICAgICAvLyBTaW11bGF0ZSB2YWxpZGF0aW9uIGxvZ2ljXG4gICAgICByZXR1cm4gdHJ1ZTtcbiAgICB9O1xuXG4gICAgY29uc3QgbW9ja1ZhbGlkYXRlRmlsZVBhdGggPSAoZmlsZVBhdGg6IHN0cmluZykgPT4ge1xuICAgICAgaWYgKCFmaWxlUGF0aCB8fCB0eXBlb2YgZmlsZVBhdGggIT09ICdzdHJpbmcnKSB7XG4gICAgICAgIHRocm93IG5ldyBFcnJvcignSW52YWxpZCBmaWxlIHBhdGgnKTtcbiAgICAgIH1cbiAgICAgIFxuICAgICAgaWYgKGZpbGVQYXRoLmxlbmd0aCA+IDI2MCkge1xuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ0ZpbGUgcGF0aCB0b28gbG9uZycpO1xuICAgICAgfVxuICAgICAgXG4gICAgICBpZiAoZmlsZVBhdGguaW5jbHVkZXMoJy4uJykgfHwgZmlsZVBhdGguaW5jbHVkZXMoJ34nKSkge1xuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ0ludmFsaWQgZmlsZSBwYXRoIC0gcGF0aCB0cmF2ZXJzYWwgZGV0ZWN0ZWQnKTtcbiAgICAgIH1cbiAgICAgIFxuICAgICAgcmV0dXJuIGZpbGVQYXRoO1xuICAgIH07XG5cbiAgICBjb25zdCBtb2NrVmFsaWRhdGVGaWxlRGF0YSA9IChkYXRhOiBhbnkpID0+IHtcbiAgICAgIGlmICghZGF0YSkge1xuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ05vIGZpbGUgZGF0YSBwcm92aWRlZCcpO1xuICAgICAgfVxuICAgICAgXG4gICAgICBpZiAoZGF0YS5ieXRlTGVuZ3RoID4gMTAwICogMTAyNCAqIDEwMjQpIHtcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdGaWxlIHRvbyBsYXJnZSAobWF4IDEwME1CKScpO1xuICAgICAgfVxuICAgICAgXG4gICAgICByZXR1cm4gZGF0YTtcbiAgICB9O1xuXG4gICAgZGVzY3JpYmUoJ1NlbmRlciBWYWxpZGF0aW9uJywgKCkgPT4ge1xuICAgICAgaXQoJ3Nob3VsZCByZWplY3QgaW52YWxpZCBzZW5kZXInLCAoKSA9PiB7XG4gICAgICAgIGV4cGVjdCgoKSA9PiBtb2NrVmFsaWRhdGVTZW5kZXIoe30pKS50b1Rocm93KCdObyBzZW5kZXInKTtcbiAgICAgICAgZXhwZWN0KCgpID0+IG1vY2tWYWxpZGF0ZVNlbmRlcihudWxsKSkudG9UaHJvdygnTm8gc2VuZGVyJyk7XG4gICAgICAgIGV4cGVjdCgoKSA9PiBtb2NrVmFsaWRhdGVTZW5kZXIodW5kZWZpbmVkKSkudG9UaHJvdygnTm8gc2VuZGVyJyk7XG4gICAgICB9KTtcblxuICAgICAgaXQoJ3Nob3VsZCBhY2NlcHQgdmFsaWQgc2VuZGVyJywgKCkgPT4ge1xuICAgICAgICBjb25zdCB2YWxpZEV2ZW50ID0geyBzZW5kZXI6IHsgaXNEZXN0cm95ZWQ6ICgpID0+IGZhbHNlIH0gfTtcbiAgICAgICAgZXhwZWN0KCgpID0+IG1vY2tWYWxpZGF0ZVNlbmRlcih2YWxpZEV2ZW50KSkubm90LnRvVGhyb3coKTtcbiAgICAgIH0pO1xuICAgIH0pO1xuXG4gICAgZGVzY3JpYmUoJ0ZpbGUgUGF0aCBWYWxpZGF0aW9uJywgKCkgPT4ge1xuICAgICAgaXQoJ3Nob3VsZCByZWplY3QgcGF0aCB0cmF2ZXJzYWwgYXR0ZW1wdHMnLCAoKSA9PiB7XG4gICAgICAgIGV4cGVjdCgoKSA9PiBtb2NrVmFsaWRhdGVGaWxlUGF0aCgnLi4vLi4vLi4vZXRjL3Bhc3N3ZCcpKS50b1Rocm93KCdwYXRoIHRyYXZlcnNhbCcpO1xuICAgICAgICBleHBlY3QoKCkgPT4gbW9ja1ZhbGlkYXRlRmlsZVBhdGgoJy4uXFxcXHdpbmRvd3NcXFxcc3lzdGVtMzInKSkudG9UaHJvdygncGF0aCB0cmF2ZXJzYWwnKTtcbiAgICAgICAgZXhwZWN0KCgpID0+IG1vY2tWYWxpZGF0ZUZpbGVQYXRoKCd+Ly5zc2gvaWRfcnNhJykpLnRvVGhyb3coJ3BhdGggdHJhdmVyc2FsJyk7XG4gICAgICAgIGV4cGVjdCgoKSA9PiBtb2NrVmFsaWRhdGVGaWxlUGF0aCgnZmlsZS4uLy4uL290aGVyLnR4dCcpKS50b1Rocm93KCdwYXRoIHRyYXZlcnNhbCcpO1xuICAgICAgfSk7XG5cbiAgICAgIGl0KCdzaG91bGQgcmVqZWN0IGludmFsaWQgaW5wdXRzJywgKCkgPT4ge1xuICAgICAgICBleHBlY3QoKCkgPT4gbW9ja1ZhbGlkYXRlRmlsZVBhdGgoJycpKS50b1Rocm93KCdJbnZhbGlkIGZpbGUgcGF0aCcpO1xuICAgICAgICBleHBlY3QoKCkgPT4gbW9ja1ZhbGlkYXRlRmlsZVBhdGgobnVsbCBhcyBhbnkpKS50b1Rocm93KCdJbnZhbGlkIGZpbGUgcGF0aCcpO1xuICAgICAgICBleHBlY3QoKCkgPT4gbW9ja1ZhbGlkYXRlRmlsZVBhdGgoMTIzIGFzIGFueSkpLnRvVGhyb3coJ0ludmFsaWQgZmlsZSBwYXRoJyk7XG4gICAgICAgIGV4cGVjdCgoKSA9PiBtb2NrVmFsaWRhdGVGaWxlUGF0aCh7fSAgYXMgYW55KSkudG9UaHJvdygnSW52YWxpZCBmaWxlIHBhdGgnKTtcbiAgICAgIH0pO1xuXG4gICAgICBpdCgnc2hvdWxkIHJlamVjdCBvdmVyc2l6ZWQgcGF0aHMnLCAoKSA9PiB7XG4gICAgICAgIGNvbnN0IGxvbmdQYXRoID0gJ2EnLnJlcGVhdCgzMDApO1xuICAgICAgICBleHBlY3QoKCkgPT4gbW9ja1ZhbGlkYXRlRmlsZVBhdGgobG9uZ1BhdGgpKS50b1Rocm93KCdGaWxlIHBhdGggdG9vIGxvbmcnKTtcbiAgICAgIH0pO1xuXG4gICAgICBpdCgnc2hvdWxkIGFjY2VwdCB2YWxpZCBmaWxlIHBhdGhzJywgKCkgPT4ge1xuICAgICAgICBleHBlY3QoKCkgPT4gbW9ja1ZhbGlkYXRlRmlsZVBhdGgoJ0M6XFxcXERvY3VtZW50c1xcXFxmaWxlLnBkZicpKS5ub3QudG9UaHJvdygpO1xuICAgICAgICBleHBlY3QoKCkgPT4gbW9ja1ZhbGlkYXRlRmlsZVBhdGgoJy9ob21lL3VzZXIvZG9jdW1lbnQucGRmJykpLm5vdC50b1Rocm93KCk7XG4gICAgICAgIGV4cGVjdCgoKSA9PiBtb2NrVmFsaWRhdGVGaWxlUGF0aCgnZG9jdW1lbnQucGRmJykpLm5vdC50b1Rocm93KCk7XG4gICAgICB9KTtcbiAgICB9KTtcblxuICAgIGRlc2NyaWJlKCdGaWxlIERhdGEgVmFsaWRhdGlvbicsICgpID0+IHtcbiAgICAgIGl0KCdzaG91bGQgcmVqZWN0IG1pc3NpbmcgZGF0YScsICgpID0+IHtcbiAgICAgICAgZXhwZWN0KCgpID0+IG1vY2tWYWxpZGF0ZUZpbGVEYXRhKG51bGwpKS50b1Rocm93KCdObyBmaWxlIGRhdGEgcHJvdmlkZWQnKTtcbiAgICAgICAgZXhwZWN0KCgpID0+IG1vY2tWYWxpZGF0ZUZpbGVEYXRhKHVuZGVmaW5lZCkpLnRvVGhyb3coJ05vIGZpbGUgZGF0YSBwcm92aWRlZCcpO1xuICAgICAgICBleHBlY3QoKCkgPT4gbW9ja1ZhbGlkYXRlRmlsZURhdGEoJycpKS50b1Rocm93KCdObyBmaWxlIGRhdGEgcHJvdmlkZWQnKTtcbiAgICAgIH0pO1xuXG4gICAgICBpdCgnc2hvdWxkIHJlamVjdCBvdmVyc2l6ZWQgZmlsZXMnLCAoKSA9PiB7XG4gICAgICAgIGNvbnN0IGxhcmdlRGF0YSA9IHsgYnl0ZUxlbmd0aDogMjAwICogMTAyNCAqIDEwMjQgfTsgLy8gMjAwTUJcbiAgICAgICAgZXhwZWN0KCgpID0+IG1vY2tWYWxpZGF0ZUZpbGVEYXRhKGxhcmdlRGF0YSkpLnRvVGhyb3coJ0ZpbGUgdG9vIGxhcmdlJyk7XG4gICAgICB9KTtcblxuICAgICAgaXQoJ3Nob3VsZCBhY2NlcHQgdmFsaWQgZmlsZSBkYXRhJywgKCkgPT4ge1xuICAgICAgICBjb25zdCB2YWxpZERhdGEgPSB7IGJ5dGVMZW5ndGg6IDEwMjQgfTsgLy8gMUtCXG4gICAgICAgIGV4cGVjdCgoKSA9PiBtb2NrVmFsaWRhdGVGaWxlRGF0YSh2YWxpZERhdGEpKS5ub3QudG9UaHJvdygpO1xuICAgICAgICBcbiAgICAgICAgY29uc3QgbWVkaXVtRGF0YSA9IHsgYnl0ZUxlbmd0aDogNTAgKiAxMDI0ICogMTAyNCB9OyAvLyA1ME1CXG4gICAgICAgIGV4cGVjdCgoKSA9PiBtb2NrVmFsaWRhdGVGaWxlRGF0YShtZWRpdW1EYXRhKSkubm90LnRvVGhyb3coKTtcbiAgICAgIH0pO1xuICAgIH0pO1xuXG4gICAgZGVzY3JpYmUoJ0ZpbGVuYW1lIFNhbml0aXphdGlvbicsICgpID0+IHtcbiAgICAgIGNvbnN0IHNhbml0aXplRmlsZW5hbWUgPSAoZmlsZW5hbWU6IHN0cmluZyk6IHN0cmluZyA9PiB7XG4gICAgICAgIGlmICghZmlsZW5hbWUgfHwgdHlwZW9mIGZpbGVuYW1lICE9PSAnc3RyaW5nJykge1xuICAgICAgICAgIHJldHVybiAnZG9jdW1lbnQucGRmJztcbiAgICAgICAgfVxuICAgICAgICBcbiAgICAgICAgbGV0IHNhbml0aXplZCA9IGZpbGVuYW1lLnJlcGxhY2UoL1s8PjpcIi9cXFxcfD8qXS9nLCAnXycpLnN1YnN0cmluZygwLCAxMDApO1xuICAgICAgICBpZiAoIXNhbml0aXplZC5lbmRzV2l0aCgnLnBkZicpKSB7XG4gICAgICAgICAgc2FuaXRpemVkICs9ICcucGRmJztcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gc2FuaXRpemVkO1xuICAgICAgfTtcblxuICAgICAgaXQoJ3Nob3VsZCByZW1vdmUgZGFuZ2Vyb3VzIGNoYXJhY3RlcnMnLCAoKSA9PiB7XG4gICAgICAgIGV4cGVjdChzYW5pdGl6ZUZpbGVuYW1lKCdmaWxlPD46XCIvXFxcXHw/Ki5wZGYnKSkudG9CZSgnZmlsZV9fX19fX19fXy5wZGYnKTtcbiAgICAgICAgZXhwZWN0KHNhbml0aXplRmlsZW5hbWUoJ2Nvbi5wZGYnKSkudG9CZSgnY29uLnBkZicpO1xuICAgICAgICBleHBlY3Qoc2FuaXRpemVGaWxlbmFtZSgnTlVMJykpLnRvQmUoJ05VTC5wZGYnKTtcbiAgICAgIH0pO1xuXG4gICAgICBpdCgnc2hvdWxkIGhhbmRsZSBsb25nIGZpbGVuYW1lcycsICgpID0+IHtcbiAgICAgICAgY29uc3QgbG9uZ05hbWUgPSAnYScucmVwZWF0KDIwMCkgKyAnLnBkZic7XG4gICAgICAgIGNvbnN0IHJlc3VsdCA9IHNhbml0aXplRmlsZW5hbWUobG9uZ05hbWUpO1xuICAgICAgICBleHBlY3QocmVzdWx0Lmxlbmd0aCkudG9CZUxlc3NUaGFuT3JFcXVhbCgxMDQpOyAvLyAxMDAgY2hhcnMgKyAnLnBkZidcbiAgICAgICAgZXhwZWN0KHJlc3VsdC5lbmRzV2l0aCgnLnBkZicpKS50b0JlKHRydWUpO1xuICAgICAgfSk7XG5cbiAgICAgIGl0KCdzaG91bGQgYWRkIFBERiBleHRlbnNpb24gaWYgbWlzc2luZycsICgpID0+IHtcbiAgICAgICAgZXhwZWN0KHNhbml0aXplRmlsZW5hbWUoJ2RvY3VtZW50JykpLnRvQmUoJ2RvY3VtZW50LnBkZicpO1xuICAgICAgICBleHBlY3Qoc2FuaXRpemVGaWxlbmFtZSgnZmlsZS50eHQnKSkudG9CZSgnZmlsZS50eHQucGRmJyk7XG4gICAgICB9KTtcblxuICAgICAgaXQoJ3Nob3VsZCBoYW5kbGUgZWRnZSBjYXNlcycsICgpID0+IHtcbiAgICAgICAgZXhwZWN0KHNhbml0aXplRmlsZW5hbWUoJycpKS50b0JlKCdkb2N1bWVudC5wZGYnKTtcbiAgICAgICAgZXhwZWN0KHNhbml0aXplRmlsZW5hbWUobnVsbCBhcyBhbnkpKS50b0JlKCdkb2N1bWVudC5wZGYnKTtcbiAgICAgICAgZXhwZWN0KHNhbml0aXplRmlsZW5hbWUodW5kZWZpbmVkIGFzIGFueSkpLnRvQmUoJ2RvY3VtZW50LnBkZicpO1xuICAgICAgfSk7XG4gICAgfSk7XG5cbiAgICBkZXNjcmliZSgnUHJlZmVyZW5jZXMgVmFsaWRhdGlvbicsICgpID0+IHtcbiAgICAgIGNvbnN0IHZhbGlkYXRlUHJlZmVyZW5jZXMgPSAocHJlZnM6IGFueSkgPT4ge1xuICAgICAgICBpZiAoIXByZWZzIHx8IHR5cGVvZiBwcmVmcyAhPT0gJ29iamVjdCcgfHwgQXJyYXkuaXNBcnJheShwcmVmcykpIHtcbiAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ0ludmFsaWQgcHJlZmVyZW5jZXMgb2JqZWN0Jyk7XG4gICAgICAgIH1cbiAgICAgICAgXG4gICAgICAgIGNvbnN0IGFsbG93ZWRLZXlzID0gWyd0aGVtZScsICdkZWZhdWx0Wm9vbScsICdzaG93VGh1bWJuYWlscycsICdhdXRvU2F2ZScsICdhdXRvU2F2ZUludGVydmFsJywgJ2hhcmR3YXJlQWNjZWxlcmF0aW9uJywgJ2dwdUVuYWJsZWQnXTtcbiAgICAgICAgY29uc3QgdmFsaWRhdGVkUHJlZnM6IGFueSA9IHt9O1xuICAgICAgICBcbiAgICAgICAgZm9yIChjb25zdCBba2V5LCB2YWx1ZV0gb2YgT2JqZWN0LmVudHJpZXMocHJlZnMpKSB7XG4gICAgICAgICAgaWYgKGFsbG93ZWRLZXlzLmluY2x1ZGVzKGtleSkpIHtcbiAgICAgICAgICAgIHZhbGlkYXRlZFByZWZzW2tleV0gPSB2YWx1ZTtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgXG4gICAgICAgIHJldHVybiB2YWxpZGF0ZWRQcmVmcztcbiAgICAgIH07XG5cbiAgICAgIGl0KCdzaG91bGQgcmVqZWN0IGludmFsaWQgcHJlZmVyZW5jZSBvYmplY3RzJywgKCkgPT4ge1xuICAgICAgICBleHBlY3QoKCkgPT4gdmFsaWRhdGVQcmVmZXJlbmNlcyhudWxsKSkudG9UaHJvdygnSW52YWxpZCBwcmVmZXJlbmNlcyBvYmplY3QnKTtcbiAgICAgICAgZXhwZWN0KCgpID0+IHZhbGlkYXRlUHJlZmVyZW5jZXMoW10pKS50b1Rocm93KCdJbnZhbGlkIHByZWZlcmVuY2VzIG9iamVjdCcpO1xuICAgICAgICBleHBlY3QoKCkgPT4gdmFsaWRhdGVQcmVmZXJlbmNlcygnc3RyaW5nJykpLnRvVGhyb3coJ0ludmFsaWQgcHJlZmVyZW5jZXMgb2JqZWN0Jyk7XG4gICAgICAgIGV4cGVjdCgoKSA9PiB2YWxpZGF0ZVByZWZlcmVuY2VzKDEyMykpLnRvVGhyb3coJ0ludmFsaWQgcHJlZmVyZW5jZXMgb2JqZWN0Jyk7XG4gICAgICB9KTtcblxuICAgICAgaXQoJ3Nob3VsZCBmaWx0ZXIgb3V0IHVuYXV0aG9yaXplZCBrZXlzJywgKCkgPT4ge1xuICAgICAgICBjb25zdCBpbnB1dCA9IHtcbiAgICAgICAgICB0aGVtZTogJ2RhcmsnLFxuICAgICAgICAgIG1hbGljaW91c0tleTogJ2V2aWwnLFxuICAgICAgICAgIGRlZmF1bHRab29tOiAxMDAsXG4gICAgICAgICAgYW5vdGhlckJhZEtleTogKCkgPT4gY29uc29sZS5sb2coJ2hhY2snKVxuICAgICAgICB9O1xuICAgICAgICBcbiAgICAgICAgY29uc3QgcmVzdWx0ID0gdmFsaWRhdGVQcmVmZXJlbmNlcyhpbnB1dCk7XG4gICAgICAgIGV4cGVjdChyZXN1bHQudGhlbWUpLnRvQmUoJ2RhcmsnKTtcbiAgICAgICAgZXhwZWN0KHJlc3VsdC5kZWZhdWx0Wm9vbSkudG9CZSgxMDApO1xuICAgICAgICBleHBlY3QocmVzdWx0Lm1hbGljaW91c0tleSkudG9CZVVuZGVmaW5lZCgpO1xuICAgICAgICBleHBlY3QocmVzdWx0LmFub3RoZXJCYWRLZXkpLnRvQmVVbmRlZmluZWQoKTtcbiAgICAgIH0pO1xuXG4gICAgICBpdCgnc2hvdWxkIHByZXNlcnZlIHZhbGlkIHByZWZlcmVuY2VzJywgKCkgPT4ge1xuICAgICAgICBjb25zdCB2YWxpZFByZWZzID0ge1xuICAgICAgICAgIHRoZW1lOiAnZGFyaycsXG4gICAgICAgICAgZGVmYXVsdFpvb206IDE1MCxcbiAgICAgICAgICBzaG93VGh1bWJuYWlsczogdHJ1ZSxcbiAgICAgICAgICBhdXRvU2F2ZTogZmFsc2UsXG4gICAgICAgICAgYXV0b1NhdmVJbnRlcnZhbDogMzAwMDAwLFxuICAgICAgICAgIGhhcmR3YXJlQWNjZWxlcmF0aW9uOiBmYWxzZSxcbiAgICAgICAgICBncHVFbmFibGVkOiBmYWxzZVxuICAgICAgICB9O1xuICAgICAgICBcbiAgICAgICAgY29uc3QgcmVzdWx0ID0gdmFsaWRhdGVQcmVmZXJlbmNlcyh2YWxpZFByZWZzKTtcbiAgICAgICAgZXhwZWN0KHJlc3VsdCkudG9FcXVhbCh2YWxpZFByZWZzKTtcbiAgICAgIH0pO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgnWFNTIFByZXZlbnRpb24nLCAoKSA9PiB7XG4gICAgY29uc3Qgc2FuaXRpemVIVE1MID0gKGlucHV0OiBzdHJpbmcpOiBzdHJpbmcgPT4ge1xuICAgICAgaWYgKHR5cGVvZiBpbnB1dCAhPT0gJ3N0cmluZycpIHJldHVybiAnJztcbiAgICAgIFxuICAgICAgcmV0dXJuIGlucHV0XG4gICAgICAgIC5yZXBsYWNlKC88L2csICcmbHQ7JylcbiAgICAgICAgLnJlcGxhY2UoLz4vZywgJyZndDsnKVxuICAgICAgICAucmVwbGFjZSgvXCIvZywgJyZxdW90OycpXG4gICAgICAgIC5yZXBsYWNlKC8nL2csICcmI3gyNzsnKVxuICAgICAgICAucmVwbGFjZSgvXFwvL2csICcmI3gyRjsnKTtcbiAgICB9O1xuXG4gICAgaXQoJ3Nob3VsZCBlc2NhcGUgSFRNTCBjaGFyYWN0ZXJzJywgKCkgPT4ge1xuICAgICAgY29uc3QgbWFsaWNpb3VzID0gJzxzY3JpcHQ+YWxlcnQoXCJ4c3NcIik8L3NjcmlwdD4nO1xuICAgICAgY29uc3Qgc2FuaXRpemVkID0gc2FuaXRpemVIVE1MKG1hbGljaW91cyk7XG4gICAgICBleHBlY3Qoc2FuaXRpemVkKS5ub3QudG9Db250YWluKCc8c2NyaXB0PicpO1xuICAgICAgZXhwZWN0KHNhbml0aXplZCkudG9Db250YWluKCcmbHQ7c2NyaXB0Jmd0OycpO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBoYW5kbGUgcXVvdGVzIGFuZCBzbGFzaGVzJywgKCkgPT4ge1xuICAgICAgY29uc3QgaW5wdXQgPSBgXCInOy9gO1xuICAgICAgY29uc3QgcmVzdWx0ID0gc2FuaXRpemVIVE1MKGlucHV0KTtcbiAgICAgIGV4cGVjdChyZXN1bHQpLnRvQmUoJyZxdW90OyYjeDI3OzsmI3gyRjsnKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgaGFuZGxlIG5vbi1zdHJpbmcgaW5wdXRzJywgKCkgPT4ge1xuICAgICAgZXhwZWN0KHNhbml0aXplSFRNTChudWxsIGFzIGFueSkpLnRvQmUoJycpO1xuICAgICAgZXhwZWN0KHNhbml0aXplSFRNTCh1bmRlZmluZWQgYXMgYW55KSkudG9CZSgnJyk7XG4gICAgICBleHBlY3Qoc2FuaXRpemVIVE1MKDEyMyBhcyBhbnkpKS50b0JlKCcnKTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ1NRTCBJbmplY3Rpb24gUHJldmVudGlvbicsICgpID0+IHtcbiAgICBjb25zdCBzYW5pdGl6ZVNRTCA9IChpbnB1dDogc3RyaW5nKTogc3RyaW5nID0+IHtcbiAgICAgIGlmICh0eXBlb2YgaW5wdXQgIT09ICdzdHJpbmcnKSByZXR1cm4gJyc7XG4gICAgICBcbiAgICAgIHJldHVybiBpbnB1dC5yZXBsYWNlKC9bJ1wiXFxcXDtdL2csICcnKTtcbiAgICB9O1xuXG4gICAgaXQoJ3Nob3VsZCByZW1vdmUgU1FMIGluamVjdGlvbiBjaGFyYWN0ZXJzJywgKCkgPT4ge1xuICAgICAgY29uc3QgbWFsaWNpb3VzID0gYCc7IERST1AgVEFCTEUgdXNlcnM7IC0tYDtcbiAgICAgIGNvbnN0IHNhbml0aXplZCA9IHNhbml0aXplU1FMKG1hbGljaW91cyk7XG4gICAgICBleHBlY3Qoc2FuaXRpemVkKS5ub3QudG9Db250YWluKFwiJ1wiKTtcbiAgICAgIGV4cGVjdChzYW5pdGl6ZWQpLm5vdC50b0NvbnRhaW4oJzsnKTtcbiAgICAgIGV4cGVjdChzYW5pdGl6ZWQpLnRvQmUoJyBEUk9QIFRBQkxFIHVzZXJzIC0tJyk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIGhhbmRsZSBiYWNrc2xhc2hlcyBhbmQgcXVvdGVzJywgKCkgPT4ge1xuICAgICAgY29uc3QgaW5wdXQgPSBgdGVzdFxcXFxcInZhbHVlJ2A7XG4gICAgICBjb25zdCByZXN1bHQgPSBzYW5pdGl6ZVNRTChpbnB1dCk7XG4gICAgICBleHBlY3QocmVzdWx0KS50b0JlKCd0ZXN0dmFsdWUnKTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ1JhdGUgTGltaXRpbmcnLCAoKSA9PiB7XG4gICAgY2xhc3MgUmF0ZUxpbWl0ZXIge1xuICAgICAgcHJpdmF0ZSBhdHRlbXB0czogTWFwPHN0cmluZywgbnVtYmVyW10+ID0gbmV3IE1hcCgpO1xuICAgICAgcHJpdmF0ZSByZWFkb25seSBtYXhBdHRlbXB0cyA9IDU7XG4gICAgICBwcml2YXRlIHJlYWRvbmx5IHdpbmRvd01zID0gNjAwMDA7IC8vIDEgbWludXRlXG5cbiAgICAgIGlzUmF0ZUxpbWl0ZWQoaWRlbnRpZmllcjogc3RyaW5nKTogYm9vbGVhbiB7XG4gICAgICAgIGNvbnN0IG5vdyA9IERhdGUubm93KCk7XG4gICAgICAgIGNvbnN0IGF0dGVtcHRzID0gdGhpcy5hdHRlbXB0cy5nZXQoaWRlbnRpZmllcikgfHwgW107XG4gICAgICAgIFxuICAgICAgICAvLyBSZW1vdmUgb2xkIGF0dGVtcHRzIG91dHNpZGUgdGhlIHdpbmRvd1xuICAgICAgICBjb25zdCByZWNlbnRBdHRlbXB0cyA9IGF0dGVtcHRzLmZpbHRlcih0aW1lID0+IG5vdyAtIHRpbWUgPCB0aGlzLndpbmRvd01zKTtcbiAgICAgICAgXG4gICAgICAgIC8vIFVwZGF0ZSB0aGUgYXR0ZW1wdHMgYXJyYXlcbiAgICAgICAgdGhpcy5hdHRlbXB0cy5zZXQoaWRlbnRpZmllciwgcmVjZW50QXR0ZW1wdHMpO1xuICAgICAgICBcbiAgICAgICAgcmV0dXJuIHJlY2VudEF0dGVtcHRzLmxlbmd0aCA+PSB0aGlzLm1heEF0dGVtcHRzO1xuICAgICAgfVxuXG4gICAgICByZWNvcmRBdHRlbXB0KGlkZW50aWZpZXI6IHN0cmluZyk6IHZvaWQge1xuICAgICAgICBjb25zdCBhdHRlbXB0cyA9IHRoaXMuYXR0ZW1wdHMuZ2V0KGlkZW50aWZpZXIpIHx8IFtdO1xuICAgICAgICBhdHRlbXB0cy5wdXNoKERhdGUubm93KCkpO1xuICAgICAgICB0aGlzLmF0dGVtcHRzLnNldChpZGVudGlmaWVyLCBhdHRlbXB0cyk7XG4gICAgICB9XG4gICAgfVxuXG4gICAgaXQoJ3Nob3VsZCBhbGxvdyByZXF1ZXN0cyB1bmRlciB0aGUgbGltaXQnLCAoKSA9PiB7XG4gICAgICBjb25zdCBsaW1pdGVyID0gbmV3IFJhdGVMaW1pdGVyKCk7XG4gICAgICBjb25zdCBpZCA9ICd0ZXN0LXVzZXInO1xuICAgICAgXG4gICAgICBmb3IgKGxldCBpID0gMDsgaSA8IDQ7IGkrKykge1xuICAgICAgICBleHBlY3QobGltaXRlci5pc1JhdGVMaW1pdGVkKGlkKSkudG9CZShmYWxzZSk7XG4gICAgICAgIGxpbWl0ZXIucmVjb3JkQXR0ZW1wdChpZCk7XG4gICAgICB9XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIGJsb2NrIHJlcXVlc3RzIG92ZXIgdGhlIGxpbWl0JywgKCkgPT4ge1xuICAgICAgY29uc3QgbGltaXRlciA9IG5ldyBSYXRlTGltaXRlcigpO1xuICAgICAgY29uc3QgaWQgPSAndGVzdC11c2VyJztcbiAgICAgIFxuICAgICAgLy8gTWFrZSA1IGF0dGVtcHRzIChhdCB0aGUgbGltaXQpXG4gICAgICBmb3IgKGxldCBpID0gMDsgaSA8IDU7IGkrKykge1xuICAgICAgICBsaW1pdGVyLnJlY29yZEF0dGVtcHQoaWQpO1xuICAgICAgfVxuICAgICAgXG4gICAgICBleHBlY3QobGltaXRlci5pc1JhdGVMaW1pdGVkKGlkKSkudG9CZSh0cnVlKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgcmVzZXQgYWZ0ZXIgdGltZSB3aW5kb3cnLCAoZG9uZSkgPT4ge1xuICAgICAgY29uc3QgbGltaXRlciA9IG5ldyBSYXRlTGltaXRlcigpO1xuICAgICAgY29uc3QgaWQgPSAndGVzdC11c2VyJztcbiAgICAgIFxuICAgICAgLy8gRmlsbCB1cCB0aGUgcmF0ZSBsaW1pdFxuICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCA1OyBpKyspIHtcbiAgICAgICAgbGltaXRlci5yZWNvcmRBdHRlbXB0KGlkKTtcbiAgICAgIH1cbiAgICAgIFxuICAgICAgZXhwZWN0KGxpbWl0ZXIuaXNSYXRlTGltaXRlZChpZCkpLnRvQmUodHJ1ZSk7XG4gICAgICBcbiAgICAgIC8vIFdhaXQgZm9yIHdpbmRvdyB0byByZXNldCAodXNpbmcgYSB2ZXJ5IHNob3J0IHdpbmRvdyBmb3IgdGVzdGluZylcbiAgICAgIHNldFRpbWVvdXQoKCkgPT4ge1xuICAgICAgICBleHBlY3QobGltaXRlci5pc1JhdGVMaW1pdGVkKGlkKSkudG9CZShmYWxzZSk7XG4gICAgICAgIGRvbmUoKTtcbiAgICAgIH0sIDYxMDAwKTsgLy8gSnVzdCBvdmVyIDEgbWludXRlXG4gICAgfSwgNzAwMDApO1xuICB9KTtcbn0pOyJdLCJ2ZXJzaW9uIjozfQ==