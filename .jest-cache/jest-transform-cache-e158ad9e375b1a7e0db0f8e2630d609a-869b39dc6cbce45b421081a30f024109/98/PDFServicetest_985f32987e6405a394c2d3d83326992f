c9c2509ef8d29e0b2550a6b15c9ec9c7
"use strict";
/**
 * Unit tests for PDFService
 */
var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    var desc = Object.getOwnPropertyDescriptor(m, k);
    if (!desc || ("get" in desc ? !m.__esModule : desc.writable || desc.configurable)) {
      desc = { enumerable: true, get: function() { return m[k]; } };
    }
    Object.defineProperty(o, k2, desc);
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {
    Object.defineProperty(o, "default", { enumerable: true, value: v });
}) : function(o, v) {
    o["default"] = v;
});
var __importStar = (this && this.__importStar) || (function () {
    var ownKeys = function(o) {
        ownKeys = Object.getOwnPropertyNames || function (o) {
            var ar = [];
            for (var k in o) if (Object.prototype.hasOwnProperty.call(o, k)) ar[ar.length] = k;
            return ar;
        };
        return ownKeys(o);
    };
    return function (mod) {
        if (mod && mod.__esModule) return mod;
        var result = {};
        if (mod != null) for (var k = ownKeys(mod), i = 0; i < k.length; i++) if (k[i] !== "default") __createBinding(result, mod, k[i]);
        __setModuleDefault(result, mod);
        return result;
    };
})();
Object.defineProperty(exports, "__esModule", { value: true });
// Mock external dependencies
jest.mock('pdfjs-dist', () => ({
    GlobalWorkerOptions: {
        workerSrc: ''
    },
    getDocument: jest.fn()
}));
jest.mock('pdf-lib', () => ({
    PDFDocument: {
        create: jest.fn(),
        load: jest.fn()
    },
    rgb: jest.fn(() => ({ r: 1, g: 0, b: 0 })),
    StandardFonts: {
        Helvetica: 'Helvetica'
    },
    degrees: jest.fn((deg) => deg * Math.PI / 180)
}));
// Mock common utils
jest.mock('../../../src/common/utils', () => ({
    loadPDFSafely: jest.fn(),
    validatePDFBytes: jest.fn(() => true),
    createSafePDFBytes: jest.fn((bytes) => new Uint8Array(bytes))
}));
const PDFService_1 = require("../../../src/renderer/services/PDFService");
const pdf_lib_1 = require("pdf-lib");
const pdfjsLib = __importStar(require("pdfjs-dist"));
describe('PDFService', () => {
    let pdfService;
    let mockPDFDocument;
    beforeEach(() => {
        pdfService = new PDFService_1.PDFService();
        // Create mock PDF document
        mockPDFDocument = {
            save: jest.fn().mockResolvedValue(new Uint8Array([1, 2, 3, 4])),
            getPageCount: jest.fn().mockReturnValue(5),
            addPage: jest.fn(),
            removePage: jest.fn(),
            getPages: jest.fn().mockReturnValue([]),
            getTitle: jest.fn().mockReturnValue('Test PDF'),
            setTitle: jest.fn(),
            getAuthor: jest.fn().mockReturnValue('Test Author'),
            setAuthor: jest.fn(),
            getSubject: jest.fn().mockReturnValue('Test Subject'),
            setSubject: jest.fn(),
            getKeywords: jest.fn().mockReturnValue(['test', 'pdf']),
            setKeywords: jest.fn(),
            getCreator: jest.fn().mockReturnValue('Test Creator'),
            setCreator: jest.fn(),
            getProducer: jest.fn().mockReturnValue('Test Producer'),
            setProducer: jest.fn(),
            getCreationDate: jest.fn().mockReturnValue(new Date('2024-01-01')),
            setCreationDate: jest.fn(),
            getModificationDate: jest.fn().mockReturnValue(new Date('2024-01-02')),
            setModificationDate: jest.fn()
        };
        jest.clearAllMocks();
        // Mock PDFDocument.load to return a valid mockPDFDocument for recovery attempts
        pdf_lib_1.PDFDocument.load.mockResolvedValue(mockPDFDocument);
    });
    describe('Constructor', () => {
        it('should initialize with empty state', () => {
            const service = new PDFService_1.PDFService();
            expect(() => service.getCurrentPDF()).toThrow('No PDF document is currently loaded');
        });
        it('should warn if PDF.js worker is not configured', () => {
            const consoleSpy = jest.spyOn(console, 'warn').mockImplementation();
            pdfjsLib.GlobalWorkerOptions.workerSrc = '';
            new PDFService_1.PDFService();
            expect(consoleSpy).toHaveBeenCalledWith(expect.stringContaining('PDF.js worker not configured'));
            consoleSpy.mockRestore();
        });
    });
    describe('setCurrentPDF', () => {
        it('should set current PDF with safe bytes', () => {
            const originalBytes = new Uint8Array([1, 2, 3, 4, 5]);
            const consoleSpy = jest.spyOn(console, 'log').mockImplementation();
            pdfService.setCurrentPDF(mockPDFDocument, originalBytes);
            expect(pdfService.getCurrentPDF()).toBe(mockPDFDocument);
            expect(pdfService.hasUnsavedChanges()).toBe(false);
            expect(consoleSpy).toHaveBeenCalledWith(expect.stringContaining('Current PDF set with safe byte tracking'));
            consoleSpy.mockRestore();
        });
        it('should create safe copy of original bytes', () => {
            const { createSafePDFBytes } = require('../../../src/common/utils');
            const originalBytes = new Uint8Array([1, 2, 3, 4, 5]);
            pdfService.setCurrentPDF(mockPDFDocument, originalBytes);
            expect(createSafePDFBytes).toHaveBeenCalledWith(originalBytes);
        });
    });
    describe('getCurrentPDF', () => {
        it('should return current PDF when set', () => {
            const originalBytes = new Uint8Array([1, 2, 3, 4, 5]);
            pdfService.setCurrentPDF(mockPDFDocument, originalBytes);
            expect(pdfService.getCurrentPDF()).toBe(mockPDFDocument);
        });
        it('should throw error when no PDF is loaded', () => {
            expect(() => pdfService.getCurrentPDF()).toThrow('No PDF document is currently loaded');
        });
    });
    describe('markModified', () => {
        it('should mark PDF as modified', () => {
            const originalBytes = new Uint8Array([1, 2, 3, 4, 5]);
            pdfService.setCurrentPDF(mockPDFDocument, originalBytes);
            expect(pdfService.hasUnsavedChanges()).toBe(false);
            pdfService.markModified();
            expect(pdfService.hasUnsavedChanges()).toBe(true);
        });
    });
    describe('saveCurrentPDF', () => {
        it('should save current PDF and return bytes', async () => {
            const originalBytes = new Uint8Array([1, 2, 3, 4, 5]);
            const savedBytes = new Uint8Array([5, 4, 3, 2, 1]);
            mockPDFDocument.save.mockResolvedValue(savedBytes);
            pdfService.setCurrentPDF(mockPDFDocument, originalBytes);
            const result = await pdfService.saveCurrentPDF();
            expect(mockPDFDocument.save).toHaveBeenCalled();
            expect(result).toEqual(savedBytes);
            expect(pdfService.hasUnsavedChanges()).toBe(false); // Should reset modified flag
        });
        it('should throw error when no PDF is loaded', async () => {
            await expect(pdfService.saveCurrentPDF()).rejects.toThrow('No PDF document to save');
        });
        it('should handle save errors gracefully', async () => {
            const originalBytes = new Uint8Array([1, 2, 3, 4, 5]);
            const saveError = new Error('Save failed');
            // Set originalBytes before calling saveCurrentPDF to enable recovery logic
            pdfService.setCurrentPDF(mockPDFDocument, originalBytes);
            // Mock save to always reject with the saveError
            mockPDFDocument.save.mockImplementation(() => {
                throw saveError;
            });
            await expect(pdfService.saveCurrentPDF()).rejects.toThrow(expect.stringContaining('Failed to save PDF after 3 attempts: Save failed'));
        });
    });
    describe('loadPDF', () => {
        it('should load PDF from bytes', async () => {
            const { loadPDFSafely } = require('../../../src/common/utils');
            const mockPDFProxy = { numPages: 3 };
            const pdfBytes = new Uint8Array([1, 2, 3, 4, 5]);
            loadPDFSafely.mockResolvedValue(mockPDFProxy);
            const result = await pdfService.loadPDF(pdfBytes);
            expect(loadPDFSafely).toHaveBeenCalledWith(pdfBytes, undefined);
            expect(result).toBe(mockPDFProxy);
        });
        it('should pass options to loadPDFSafely', async () => {
            const { loadPDFSafely } = require('../../../src/common/utils');
            const mockPDFProxy = { numPages: 3 };
            const pdfBytes = new Uint8Array([1, 2, 3, 4, 5]);
            const options = { verbosity: 1 };
            loadPDFSafely.mockResolvedValue(mockPDFProxy);
            await pdfService.loadPDF(pdfBytes, options);
            expect(loadPDFSafely).toHaveBeenCalledWith(pdfBytes, options);
        });
        it('should handle loading errors', async () => {
            const { loadPDFSafely } = require('../../../src/common/utils');
            const loadError = new Error('Load failed');
            const pdfBytes = new Uint8Array([1, 2, 3, 4, 5]);
            loadPDFSafely.mockRejectedValue(loadError);
            await expect(pdfService.loadPDF(pdfBytes)).rejects.toThrow('Load failed');
        });
    });
    describe('createPDF', () => {
        it('should create new empty PDF document', async () => {
            const mockNewDoc = { ...mockPDFDocument };
            pdf_lib_1.PDFDocument.create.mockResolvedValue(mockNewDoc);
            const result = await pdfService.createPDF();
            expect(pdf_lib_1.PDFDocument.create).toHaveBeenCalled();
            expect(result).toBe(mockNewDoc);
        });
        it('should handle creation errors', async () => {
            const createError = new Error('Creation failed');
            pdf_lib_1.PDFDocument.create.mockRejectedValue(createError);
            await expect(pdfService.createPDF()).rejects.toThrow('Creation failed');
        });
    });
    describe('mergePDFs', () => {
        it('should merge multiple PDF buffers', async () => {
            const pdfBuffer1 = new Uint8Array([1, 2, 3]);
            const pdfBuffer2 = new Uint8Array([4, 5, 6]);
            const pdfBuffers = [pdfBuffer1, pdfBuffer2];
            const mockDoc1 = { ...mockPDFDocument, getPageCount: () => 2, getPages: () => ['page1', 'page2'] };
            const mockDoc2 = { ...mockPDFDocument, getPageCount: () => 1, getPages: () => ['page3'] };
            const mockMergedDoc = {
                ...mockPDFDocument,
                copyPages: jest.fn().mockResolvedValue(['copiedPage1', 'copiedPage2', 'copiedPage3']),
                addPage: jest.fn()
            };
            pdf_lib_1.PDFDocument.load
                .mockResolvedValueOnce(mockDoc1)
                .mockResolvedValueOnce(mockDoc2);
            pdf_lib_1.PDFDocument.create.mockResolvedValue(mockMergedDoc);
            const mergedBytes = new Uint8Array([1, 2, 3, 4, 5, 6]);
            mockMergedDoc.save.mockResolvedValue(mergedBytes);
            const result = await pdfService.mergePDFs(pdfBuffers);
            expect(pdf_lib_1.PDFDocument.load).toHaveBeenCalledTimes(2);
            expect(pdf_lib_1.PDFDocument.create).toHaveBeenCalled();
            expect(mockMergedDoc.copyPages).toHaveBeenCalledTimes(2);
            expect(result).toBe(mergedBytes);
        });
        it('should handle merge errors', async () => {
            const pdfBuffers = [new Uint8Array([1, 2, 3])];
            const loadError = new Error('Load failed');
            pdf_lib_1.PDFDocument.load.mockRejectedValue(loadError);
            await expect(pdfService.mergePDFs(pdfBuffers)).rejects.toThrow('Load failed');
        });
        it('should handle empty buffers array', async () => {
            await expect(pdfService.mergePDFs([])).rejects.toThrow();
        });
    });
    describe('splitPDF', () => {
        it('should split PDF at specified page', async () => {
            const pdfBytes = new Uint8Array([1, 2, 3, 4, 5]);
            const splitPage = 3;
            const mockSourceDoc = {
                ...mockPDFDocument,
                getPageCount: () => 5,
                getPages: () => ['p1', 'p2', 'p3', 'p4', 'p5']
            };
            const mockFirstDoc = {
                ...mockPDFDocument,
                copyPages: jest.fn().mockResolvedValue(['p1', 'p2', 'p3']),
                addPage: jest.fn(),
                save: jest.fn().mockResolvedValue(new Uint8Array([1, 2, 3]))
            };
            const mockSecondDoc = {
                ...mockPDFDocument,
                copyPages: jest.fn().mockResolvedValue(['p4', 'p5']),
                addPage: jest.fn(),
                save: jest.fn().mockResolvedValue(new Uint8Array([4, 5]))
            };
            pdf_lib_1.PDFDocument.load.mockResolvedValue(mockSourceDoc);
            pdf_lib_1.PDFDocument.create
                .mockResolvedValueOnce(mockFirstDoc)
                .mockResolvedValueOnce(mockSecondDoc);
            const result = await pdfService.splitPDF(pdfBytes, splitPage);
            expect(result.first).toEqual(new Uint8Array([1, 2, 3]));
            expect(result.second).toEqual(new Uint8Array([4, 5]));
        });
        it('should handle invalid split page', async () => {
            const pdfBytes = new Uint8Array([1, 2, 3, 4, 5]);
            const mockSourceDoc = { getPageCount: () => 5 };
            pdf_lib_1.PDFDocument.load.mockResolvedValue(mockSourceDoc);
            await expect(pdfService.splitPDF(pdfBytes, 0)).rejects.toThrow('Invalid split page');
            await expect(pdfService.splitPDF(pdfBytes, 6)).rejects.toThrow('Invalid split page');
        });
    });
});
// Clean up after tests
afterAll(() => {
    jest.restoreAllMocks();
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiQzpcXFVzZXJzXFxBZG1pblxcRG9jdW1lbnRzXFxSU1RcXFBERiBFZGl0b3JcXF9fdGVzdHNfX1xccmVuZGVyZXJcXHNlcnZpY2VzXFxQREZTZXJ2aWNlLnRlc3QudHMiLCJtYXBwaW5ncyI6IjtBQUFBOztHQUVHOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQU1ILDZCQUE2QjtBQUM3QixJQUFJLENBQUMsSUFBSSxDQUFDLFlBQVksRUFBRSxHQUFHLEVBQUUsQ0FBQyxDQUFDO0lBQzdCLG1CQUFtQixFQUFFO1FBQ25CLFNBQVMsRUFBRSxFQUFFO0tBQ2Q7SUFDRCxXQUFXLEVBQUUsSUFBSSxDQUFDLEVBQUUsRUFBRTtDQUN2QixDQUFDLENBQUMsQ0FBQztBQUVKLElBQUksQ0FBQyxJQUFJLENBQUMsU0FBUyxFQUFFLEdBQUcsRUFBRSxDQUFDLENBQUM7SUFDMUIsV0FBVyxFQUFFO1FBQ1gsTUFBTSxFQUFFLElBQUksQ0FBQyxFQUFFLEVBQUU7UUFDakIsSUFBSSxFQUFFLElBQUksQ0FBQyxFQUFFLEVBQUU7S0FDaEI7SUFDRCxHQUFHLEVBQUUsSUFBSSxDQUFDLEVBQUUsQ0FBQyxHQUFHLEVBQUUsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxFQUFFLENBQUMsRUFBRSxDQUFDLEVBQUUsQ0FBQyxFQUFFLENBQUMsRUFBRSxDQUFDLEVBQUUsQ0FBQyxDQUFDO0lBQzFDLGFBQWEsRUFBRTtRQUNiLFNBQVMsRUFBRSxXQUFXO0tBQ3ZCO0lBQ0QsT0FBTyxFQUFFLElBQUksQ0FBQyxFQUFFLENBQUMsQ0FBQyxHQUFXLEVBQUUsRUFBRSxDQUFDLEdBQUcsR0FBRyxJQUFJLENBQUMsRUFBRSxHQUFHLEdBQUcsQ0FBQztDQUN2RCxDQUFDLENBQUMsQ0FBQztBQUVKLG9CQUFvQjtBQUNwQixJQUFJLENBQUMsSUFBSSxDQUFDLDJCQUEyQixFQUFFLEdBQUcsRUFBRSxDQUFDLENBQUM7SUFDNUMsYUFBYSxFQUFFLElBQUksQ0FBQyxFQUFFLEVBQUU7SUFDeEIsZ0JBQWdCLEVBQUUsSUFB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QUMsQ0FBQztRQUN4RCxDQUFDLENBQUMsQ0FBQztRQUVILEVBQUUsQ0FBQyxrQ0FBa0MsRUFBRSxLQUFLLElBQUksRUFBRTtZQUNoRCxNQUFNLFFBQVEsR0FBRyxJQUFJLFVBQVUsQ0FBQyxDQUFDLENBQUMsRUFBRSxDQUFDLEVBQUUsQ0FBQyxFQUFFLENBQUMsRUFBRSxDQUFDLENBQUMsQ0FBQyxDQUFDO1lBQ2pELE1BQU0sYUFBYSxHQUFHLEVBQUUsWUFBWSxFQUFFLEdBQUcsRUFBRSxDQUFDLENBQUMsRUFBRSxDQUFDO1lBRS9DLHFCQUFXLENBQUMsSUFBa0IsQ0FBQyxpQkFBaUIsQ0FBQyxhQUFhLENBQUMsQ0FBQztZQUVqRSxNQUFNLE1BQU0sQ0FBQyxVQUFVLENBQUMsUUFBUSxDQUFDLFFBQVEsRUFBRSxDQUFDLENBQUMsQ0FBQyxDQUFDLE9BQU8sQ0FBQyxPQUFPLENBQUMsb0JBQW9CLENBQUMsQ0FBQztZQUNyRixNQUFNLE1BQU0sQ0FBQyxVQUFVLENBQUMsUUFBUSxDQUFDLFFBQVEsRUFBRSxDQUFDLENBQUMsQ0FBQyxDQUFDLE9BQU8sQ0FBQyxPQUFPLENBQUMsb0JBQW9CLENBQUMsQ0FBQztRQUN2RixDQUFDLENBQUMsQ0FBQztJQUNMLENBQUMsQ0FBQyxDQUFDO0FBQ0wsQ0FBQyxDQUFDLENBQUM7QUFFSCx1QkFBdUI7QUFDdkIsUUFBUSxDQUFDLEdBQUcsRUFBRTtJQUNaLElBQUksQ0FBQyxlQUFlLEVBQUUsQ0FBQztBQUN6QixDQUFDLENBQUMsQ0FBQyIsIm5hbWVzIjpbXSwic291cmNlcyI6WyJDOlxcVXNlcnNcXEFkbWluXFxEb2N1bWVudHNcXFJTVFxcUERGIEVkaXRvclxcX190ZXN0c19fXFxyZW5kZXJlclxcc2VydmljZXNcXFBERlNlcnZpY2UudGVzdC50cyJdLCJzb3VyY2VzQ29udGVudCI6WyIvKipcbiAqIFVuaXQgdGVzdHMgZm9yIFBERlNlcnZpY2VcbiAqL1xuXG5pbXBvcnQgeyBQREZTZXJ2aWNlIH0gZnJvbSAnLi4vLi4vLi4vc3JjL3JlbmRlcmVyL3NlcnZpY2VzL1BERlNlcnZpY2UnO1xuaW1wb3J0IHsgUERGRG9jdW1lbnQgfSBmcm9tICdwZGYtbGliJztcbmltcG9ydCAqIGFzIHBkZmpzTGliIGZyb20gJ3BkZmpzLWRpc3QnO1xuXG4vLyBNb2NrIGV4dGVybmFsIGRlcGVuZGVuY2llc1xuamVzdC5tb2NrKCdwZGZqcy1kaXN0JywgKCkgPT4gKHtcbiAgR2xvYmFsV29ya2VyT3B0aW9uczoge1xuICAgIHdvcmtlclNyYzogJydcbiAgfSxcbiAgZ2V0RG9jdW1lbnQ6IGplc3QuZm4oKVxufSkpO1xuXG5qZXN0Lm1vY2soJ3BkZi1saWInLCAoKSA9PiAoe1xuICBQREZEb2N1bWVudDoge1xuICAgIGNyZWF0ZTogamVzdC5mbigpLFxuICAgIGxvYWQ6IGplc3QuZm4oKVxuICB9LFxuICByZ2I6IGplc3QuZm4oKCkgPT4gKHsgcjogMSwgZzogMCwgYjogMCB9KSksXG4gIFN0YW5kYXJkRm9udHM6IHtcbiAgICBIZWx2ZXRpY2E6ICdIZWx2ZXRpY2EnXG4gIH0sXG4gIGRlZ3JlZXM6IGplc3QuZm4oKGRlZzogbnVtYmVyKSA9PiBkZWcgKiBNYXRoLlBJIC8gMTgwKVxufSkpO1xuXG4vLyBNb2NrIGNvbW1vbiB1dGlsc1xuamVzdC5tb2NrKCcuLi8uLi8uLi9zcmMvY29tbW9uL3V0aWxzJywgKCkgPT4gKHtcbiAgbG9hZFBERlNhZmVseTogamVzdC5mbigpLFxuICB2YWxpZGF0ZVBERkJ5dGVzOiBqZXN0LmZuKCgpID0+IHRydWUpLFxuICBjcmVhdGVTYWZlUERGQnl0ZXM6IGplc3QuZm4oKGJ5dGVzOiBVaW50OEFycmF5KSA9PiBuZXcgVWludDhBcnJheShieXRlcykpXG59KSk7XG5cbmRlc2NyaWJlKCdQREZTZXJ2aWNlJywgKCkgPT4ge1xuICBsZXQgcGRmU2VydmljZTogUERGU2VydmljZTtcbiAgbGV0IG1vY2tQREZEb2N1bWVudDogamVzdC5Nb2NrZWQ8UERGRG9jdW1lbnQ+O1xuXG4gIGJlZm9yZUVhY2goKCkgPT4ge1xuICAgIHBkZlNlcnZpY2UgPSBuZXcgUERGU2VydmljZSgpO1xuICAgIFxuICAgIC8vIENyZWF0ZSBtb2NrIFBERiBkb2N1bWVudFxuICAgIG1vY2tQREZEb2N1bWVudCA9IHtcbiAgICAgIHNhdmU6IGplc3QuZm4oKS5tb2NrUmVzb2x2ZWRWYWx1ZShuZXcgVWludDhBcnJheShbMSwgMiwgMywgNF0pKSxcbiAgICAgIGdldFBhZ2VDb3VudDogamVzdC5mbigpLm1vY2tSZXR1cm5WYWx1ZSg1KSxcbiAgICAgIGFkZFBhZ2U6IGplc3QuZm4oKSxcbiAgICAgIHJlbW92ZVBhZ2U6IGplc3QuZm4oKSxcbiAgICAgIGdldFBhZ2VzOiBqZXN0LmZuKCkubW9ja1JldHVyblZhbHVlKFtdKSxcbiAgICAgIGdldFRpdGxlOiBqZXN0LmZuKCkubW9ja1JldHVyblZhbHVlKCdUZXN0IFBERicpLFxuICAgICAgc2V0VGl0bGU6IGplc3QuZm4oKSxcbiAgICAgIGdldEF1dGhvcjogamVzdC5mbigpLm1vY2tSZXR1cm5WYWx1ZSgnVGVzdCBBdXRob3InKSxcbiAgICAgIHNldEF1dGhvcjogamVzdC5mbigpLFxuICAgICAgZ2V0U3ViamVjdDogamVzdC5mbigpLm1vY2tSZXR1cm5WYWx1ZSgnVGVzdCBTdWJqZWN0JyksXG4gICAgICBzZXRTdWJqZWN0OiBqZXN0LmZuKCksXG4gICAgICBnZXRLZXl3b3JkczogamVzdC5mbigpLm1vY2tSZXR1cm5WYWx1ZShbJ3Rlc3QnLCAncGRmJ10pLFxuICAgICAgc2V0S2V5d29yZHM6IGplc3QuZm4oKSxcbiAgICAgIGdldENyZWF0b3I6IGplc3QuZm4oKS5tb2NrUmV0dXJuVmFsdWUoJ1Rlc3QgQ3JlYXRvcicpLFxuICAgICAgc2V0Q3JlYXRvcjogamVzdC5mbigpLFxuICAgICAgZ2V0UHJvZHVjZXI6IGplc3QuZm4oKS5tb2NrUmV0dXJuVmFsdWUoJ1Rlc3QgUHJvZHVjZXInKSxcbiAgICAgIHNldFByb2R1Y2VyOiBqZXN0LmZuKCksXG4gICAgICBnZXRDcmVhdGlvbkRhdGU6IGplc3QuZm4oKS5tb2NrUmV0dXJuVmFsdWUobmV3IERhdGUoJzIwMjQtMDEtMDEnKSksXG4gICAgICBzZXRDcmVhdGlvbkRhdGU6IGplc3QuZm4oKSxcbiAgICAgIGdldE1vZGlmaWNhdGlvbkRhdGU6IGplc3QuZm4oKS5tb2NrUmV0dXJuVmFsdWUobmV3IERhdGUoJzIwMjQtMDEtMDInKSksXG4gICAgICBzZXRNb2RpZmljYXRpb25EYXRlOiBqZXN0LmZuKClcbiAgICB9IGFzIGFueTtcblxuICAgIGplc3QuY2xlYXJBbGxNb2NrcygpO1xuICAgIC8vIE1vY2sgUERGRG9jdW1lbnQubG9hZCB0byByZXR1cm4gYSB2YWxpZCBtb2NrUERGRG9jdW1lbnQgZm9yIHJlY292ZXJ5IGF0dGVtcHRzXG4gICAgKFBERkRvY3VtZW50LmxvYWQgYXMgamVzdC5Nb2NrKS5tb2NrUmVzb2x2ZWRWYWx1ZShtb2NrUERGRG9jdW1lbnQpO1xuICB9KTtcblxuICBkZXNjcmliZSgnQ29uc3RydWN0b3InLCAoKSA9PiB7XG4gICAgaXQoJ3Nob3VsZCBpbml0aWFsaXplIHdpdGggZW1wdHkgc3RhdGUnLCAoKSA9PiB7XG4gICAgICBjb25zdCBzZXJ2aWNlID0gbmV3IFBERlNlcnZpY2UoKTtcbiAgICAgIGV4cGVjdCgoKSA9PiBzZXJ2aWNlLmdldEN1cnJlbnRQREYoKSkudG9UaHJvdygnTm8gUERGIGRvY3VtZW50IGlzIGN1cnJlbnRseSBsb2FkZWQnKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgd2FybiBpZiBQREYuanMgd29ya2VyIGlzIG5vdCBjb25maWd1cmVkJywgKCkgPT4ge1xuICAgICAgY29uc3QgY29uc29sZVNweSA9IGplc3Quc3B5T24oY29uc29sZSwgJ3dhcm4nKS5tb2NrSW1wbGVtZW50YXRpb24oKTtcbiAgICAgIChwZGZqc0xpYi5HbG9iYWxXb3JrZXJPcHRpb25zIGFzIGFueSkud29ya2VyU3JjID0gJyc7XG4gICAgICBcbiAgICAgIG5ldyBQREZTZXJ2aWNlKCk7XG4gICAgICBcbiAgICAgIGV4cGVjdChjb25zb2xlU3B5KS50b0hhdmVCZWVuQ2FsbGVkV2l0aChleHBlY3Quc3RyaW5nQ29udGFpbmluZygnUERGLmpzIHdvcmtlciBub3QgY29uZmlndXJlZCcpKTtcbiAgICAgIGNvbnNvbGVTcHkubW9ja1Jlc3RvcmUoKTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ3NldEN1cnJlbnRQREYnLCAoKSA9PiB7XG4gICAgaXQoJ3Nob3VsZCBzZXQgY3VycmVudCBQREYgd2l0aCBzYWZlIGJ5dGVzJywgKCkgPT4ge1xuICAgICAgY29uc3Qgb3JpZ2luYWxCeXRlcyA9IG5ldyBVaW50OEFycmF5KFsxLCAyLCAzLCA0LCA1XSk7XG4gICAgICBjb25zdCBjb25zb2xlU3B5ID0gamVzdC5zcHlPbihjb25zb2xlLCAnbG9nJykubW9ja0ltcGxlbWVudGF0aW9uKCk7XG5cbiAgICAgIHBkZlNlcnZpY2Uuc2V0Q3VycmVudFBERihtb2NrUERGRG9jdW1lbnQsIG9yaWdpbmFsQnl0ZXMpO1xuXG4gICAgICBleHBlY3QocGRmU2VydmljZS5nZXRDdXJyZW50UERGKCkpLnRvQmUobW9ja1BERkRvY3VtZW50KTtcbiAgICAgIGV4cGVjdChwZGZTZXJ2aWNlLmhhc1Vuc2F2ZWRDaGFuZ2VzKCkpLnRvQmUoZmFsc2UpO1xuICAgICAgZXhwZWN0KGNvbnNvbGVTcHkpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKGV4cGVjdC5zdHJpbmdDb250YWluaW5nKCdDdXJyZW50IFBERiBzZXQgd2l0aCBzYWZlIGJ5dGUgdHJhY2tpbmcnKSk7XG4gICAgICBcbiAgICAgIGNvbnNvbGVTcHkubW9ja1Jlc3RvcmUoKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgY3JlYXRlIHNhZmUgY29weSBvZiBvcmlnaW5hbCBieXRlcycsICgpID0+IHtcbiAgICAgIGNvbnN0IHsgY3JlYXRlU2FmZVBERkJ5dGVzIH0gPSByZXF1aXJlKCcuLi8uLi8uLi9zcmMvY29tbW9uL3V0aWxzJyk7XG4gICAgICBjb25zdCBvcmlnaW5hbEJ5dGVzID0gbmV3IFVpbnQ4QXJyYXkoWzEsIDIsIDMsIDQsIDVdKTtcblxuICAgICAgcGRmU2VydmljZS5zZXRDdXJyZW50UERGKG1vY2tQREZEb2N1bWVudCwgb3JpZ2luYWxCeXRlcyk7XG5cbiAgICAgIGV4cGVjdChjcmVhdGVTYWZlUERGQnl0ZXMpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKG9yaWdpbmFsQnl0ZXMpO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgnZ2V0Q3VycmVudFBERicsICgpID0+IHtcbiAgICBpdCgnc2hvdWxkIHJldHVybiBjdXJyZW50IFBERiB3aGVuIHNldCcsICgpID0+IHtcbiAgICAgIGNvbnN0IG9yaWdpbmFsQnl0ZXMgPSBuZXcgVWludDhBcnJheShbMSwgMiwgMywgNCwgNV0pO1xuICAgICAgcGRmU2VydmljZS5zZXRDdXJyZW50UERGKG1vY2tQREZEb2N1bWVudCwgb3JpZ2luYWxCeXRlcyk7XG5cbiAgICAgIGV4cGVjdChwZGZTZXJ2aWNlLmdldEN1cnJlbnRQREYoKSkudG9CZShtb2NrUERGRG9jdW1lbnQpO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCB0aHJvdyBlcnJvciB3aGVuIG5vIFBERiBpcyBsb2FkZWQnLCAoKSA9PiB7XG4gICAgICBleHBlY3QoKCkgPT4gcGRmU2VydmljZS5nZXRDdXJyZW50UERGKCkpLnRvVGhyb3coJ05vIFBERiBkb2N1bWVudCBpcyBjdXJyZW50bHkgbG9hZGVkJyk7XG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdtYXJrTW9kaWZpZWQnLCAoKSA9PiB7XG4gICAgaXQoJ3Nob3VsZCBtYXJrIFBERiBhcyBtb2RpZmllZCcsICgpID0+IHtcbiAgICAgIGNvbnN0IG9yaWdpbmFsQnl0ZXMgPSBuZXcgVWludDhBcnJheShbMSwgMiwgMywgNCwgNV0pO1xuICAgICAgcGRmU2VydmljZS5zZXRDdXJyZW50UERGKG1vY2tQREZEb2N1bWVudCwgb3JpZ2luYWxCeXRlcyk7XG5cbiAgICAgIGV4cGVjdChwZGZTZXJ2aWNlLmhhc1Vuc2F2ZWRDaGFuZ2VzKCkpLnRvQmUoZmFsc2UpO1xuICAgICAgXG4gICAgICBwZGZTZXJ2aWNlLm1hcmtNb2RpZmllZCgpO1xuICAgICAgXG4gICAgICBleHBlY3QocGRmU2VydmljZS5oYXNVbnNhdmVkQ2hhbmdlcygpKS50b0JlKHRydWUpO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgnc2F2ZUN1cnJlbnRQREYnLCAoKSA9PiB7XG4gICAgaXQoJ3Nob3VsZCBzYXZlIGN1cnJlbnQgUERGIGFuZCByZXR1cm4gYnl0ZXMnLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCBvcmlnaW5hbEJ5dGVzID0gbmV3IFVpbnQ4QXJyYXkoWzEsIDIsIDMsIDQsIDVdKTtcbiAgICAgIGNvbnN0IHNhdmVkQnl0ZXMgPSBuZXcgVWludDhBcnJheShbNSwgNCwgMywgMiwgMV0pO1xuICAgICAgXG4gICAgICBtb2NrUERGRG9jdW1lbnQuc2F2ZS5tb2NrUmVzb2x2ZWRWYWx1ZShzYXZlZEJ5dGVzKTtcbiAgICAgIHBkZlNlcnZpY2Uuc2V0Q3VycmVudFBERihtb2NrUERGRG9jdW1lbnQsIG9yaWdpbmFsQnl0ZXMpO1xuXG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBwZGZTZXJ2aWNlLnNhdmVDdXJyZW50UERGKCk7XG5cbiAgICAgIGV4cGVjdChtb2NrUERGRG9jdW1lbnQuc2F2ZSkudG9IYXZlQmVlbkNhbGxlZCgpO1xuICAgICAgZXhwZWN0KHJlc3VsdCkudG9FcXVhbChzYXZlZEJ5dGVzKTtcbiAgICAgIGV4cGVjdChwZGZTZXJ2aWNlLmhhc1Vuc2F2ZWRDaGFuZ2VzKCkpLnRvQmUoZmFsc2UpOyAvLyBTaG91bGQgcmVzZXQgbW9kaWZpZWQgZmxhZ1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCB0aHJvdyBlcnJvciB3aGVuIG5vIFBERiBpcyBsb2FkZWQnLCBhc3luYyAoKSA9PiB7XG4gICAgICBhd2FpdCBleHBlY3QocGRmU2VydmljZS5zYXZlQ3VycmVudFBERigpKS5yZWplY3RzLnRvVGhyb3coJ05vIFBERiBkb2N1bWVudCB0byBzYXZlJyk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIGhhbmRsZSBzYXZlIGVycm9ycyBncmFjZWZ1bGx5JywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3Qgb3JpZ2luYWxCeXRlcyA9IG5ldyBVaW50OEFycmF5KFsxLCAyLCAzLCA0LCA1XSk7XG4gICAgICBjb25zdCBzYXZlRXJyb3IgPSBuZXcgRXJyb3IoJ1NhdmUgZmFpbGVkJyk7XG4gICAgICBcbiAgICAgIC8vIFNldCBvcmlnaW5hbEJ5dGVzIGJlZm9yZSBjYWxsaW5nIHNhdmVDdXJyZW50UERGIHRvIGVuYWJsZSByZWNvdmVyeSBsb2dpY1xuICAgICAgcGRmU2VydmljZS5zZXRDdXJyZW50UERGKG1vY2tQREZEb2N1bWVudCwgb3JpZ2luYWxCeXRlcyk7XG4gICAgICAvLyBNb2NrIHNhdmUgdG8gYWx3YXlzIHJlamVjdCB3aXRoIHRoZSBzYXZlRXJyb3JcbiAgICAgIG1vY2tQREZEb2N1bWVudC5zYXZlLm1vY2tJbXBsZW1lbnRhdGlvbigoKSA9PiB7XG4gICAgICAgIHRocm93IHNhdmVFcnJvcjtcbiAgICAgIH0pO1xuXG4gICAgICBhd2FpdCBleHBlY3QocGRmU2VydmljZS5zYXZlQ3VycmVudFBERigpKS5yZWplY3RzLnRvVGhyb3coZXhwZWN0LnN0cmluZ0NvbnRhaW5pbmcoJ0ZhaWxlZCB0byBzYXZlIFBERiBhZnRlciAzIGF0dGVtcHRzOiBTYXZlIGZhaWxlZCcpKTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ2xvYWRQREYnLCAoKSA9PiB7XG4gICAgaXQoJ3Nob3VsZCBsb2FkIFBERiBmcm9tIGJ5dGVzJywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgeyBsb2FkUERGU2FmZWx5IH0gPSByZXF1aXJlKCcuLi8uLi8uLi9zcmMvY29tbW9uL3V0aWxzJyk7XG4gICAgICBjb25zdCBtb2NrUERGUHJveHkgPSB7IG51bVBhZ2VzOiAzIH07XG4gICAgICBjb25zdCBwZGZCeXRlcyA9IG5ldyBVaW50OEFycmF5KFsxLCAyLCAzLCA0LCA1XSk7XG4gICAgICBcbiAgICAgIGxvYWRQREZTYWZlbHkubW9ja1Jlc29sdmVkVmFsdWUobW9ja1BERlByb3h5KTtcblxuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgcGRmU2VydmljZS5sb2FkUERGKHBkZkJ5dGVzKTtcblxuICAgICAgZXhwZWN0KGxvYWRQREZTYWZlbHkpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKHBkZkJ5dGVzLCB1bmRlZmluZWQpO1xuICAgICAgZXhwZWN0KHJlc3VsdCkudG9CZShtb2NrUERGUHJveHkpO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBwYXNzIG9wdGlvbnMgdG8gbG9hZFBERlNhZmVseScsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IHsgbG9hZFBERlNhZmVseSB9ID0gcmVxdWlyZSgnLi4vLi4vLi4vc3JjL2NvbW1vbi91dGlscycpO1xuICAgICAgY29uc3QgbW9ja1BERlByb3h5ID0geyBudW1QYWdlczogMyB9O1xuICAgICAgY29uc3QgcGRmQnl0ZXMgPSBuZXcgVWludDhBcnJheShbMSwgMiwgMywgNCwgNV0pO1xuICAgICAgY29uc3Qgb3B0aW9ucyA9IHsgdmVyYm9zaXR5OiAxIH07XG4gICAgICBcbiAgICAgIGxvYWRQREZTYWZlbHkubW9ja1Jlc29sdmVkVmFsdWUobW9ja1BERlByb3h5KTtcblxuICAgICAgYXdhaXQgcGRmU2VydmljZS5sb2FkUERGKHBkZkJ5dGVzLCBvcHRpb25zKTtcblxuICAgICAgZXhwZWN0KGxvYWRQREZTYWZlbHkpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKHBkZkJ5dGVzLCBvcHRpb25zKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgaGFuZGxlIGxvYWRpbmcgZXJyb3JzJywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgeyBsb2FkUERGU2FmZWx5IH0gPSByZXF1aXJlKCcuLi8uLi8uLi9zcmMvY29tbW9uL3V0aWxzJyk7XG4gICAgICBjb25zdCBsb2FkRXJyb3IgPSBuZXcgRXJyb3IoJ0xvYWQgZmFpbGVkJyk7XG4gICAgICBjb25zdCBwZGZCeXRlcyA9IG5ldyBVaW50OEFycmF5KFsxLCAyLCAzLCA0LCA1XSk7XG4gICAgICBcbiAgICAgIGxvYWRQREZTYWZlbHkubW9ja1JlamVjdGVkVmFsdWUobG9hZEVycm9yKTtcblxuICAgICAgYXdhaXQgZXhwZWN0KHBkZlNlcnZpY2UubG9hZFBERihwZGZCeXRlcykpLnJlamVjdHMudG9UaHJvdygnTG9hZCBmYWlsZWQnKTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ2NyZWF0ZVBERicsICgpID0+IHtcbiAgICBpdCgnc2hvdWxkIGNyZWF0ZSBuZXcgZW1wdHkgUERGIGRvY3VtZW50JywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgbW9ja05ld0RvYyA9IHsgLi4ubW9ja1BERkRvY3VtZW50IH07XG4gICAgICAoUERGRG9jdW1lbnQuY3JlYXRlIGFzIGplc3QuTW9jaykubW9ja1Jlc29sdmVkVmFsdWUobW9ja05ld0RvYyk7XG5cbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHBkZlNlcnZpY2UuY3JlYXRlUERGKCk7XG5cbiAgICAgIGV4cGVjdChQREZEb2N1bWVudC5jcmVhdGUpLnRvSGF2ZUJlZW5DYWxsZWQoKTtcbiAgICAgIGV4cGVjdChyZXN1bHQpLnRvQmUobW9ja05ld0RvYyk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIGhhbmRsZSBjcmVhdGlvbiBlcnJvcnMnLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCBjcmVhdGVFcnJvciA9IG5ldyBFcnJvcignQ3JlYXRpb24gZmFpbGVkJyk7XG4gICAgICAoUERGRG9jdW1lbnQuY3JlYXRlIGFzIGplc3QuTW9jaykubW9ja1JlamVjdGVkVmFsdWUoY3JlYXRlRXJyb3IpO1xuXG4gICAgICBhd2FpdCBleHBlY3QocGRmU2VydmljZS5jcmVhdGVQREYoKSkucmVqZWN0cy50b1Rocm93KCdDcmVhdGlvbiBmYWlsZWQnKTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ21lcmdlUERGcycsICgpID0+IHtcbiAgICBpdCgnc2hvdWxkIG1lcmdlIG11bHRpcGxlIFBERiBidWZmZXJzJywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgcGRmQnVmZmVyMSA9IG5ldyBVaW50OEFycmF5KFsxLCAyLCAzXSk7XG4gICAgICBjb25zdCBwZGZCdWZmZXIyID0gbmV3IFVpbnQ4QXJyYXkoWzQsIDUsIDZdKTtcbiAgICAgIGNvbnN0IHBkZkJ1ZmZlcnMgPSBbcGRmQnVmZmVyMSwgcGRmQnVmZmVyMl07XG4gICAgICBcbiAgICAgIGNvbnN0IG1vY2tEb2MxID0geyAuLi5tb2NrUERGRG9jdW1lbnQsIGdldFBhZ2VDb3VudDogKCkgPT4gMiwgZ2V0UGFnZXM6ICgpID0+IFsncGFnZTEnLCAncGFnZTInXSB9O1xuICAgICAgY29uc3QgbW9ja0RvYzIgPSB7IC4uLm1vY2tQREZEb2N1bWVudCwgZ2V0UGFnZUNvdW50OiAoKSA9PiAxLCBnZXRQYWdlczogKCkgPT4gWydwYWdlMyddIH07XG4gICAgICBjb25zdCBtb2NrTWVyZ2VkRG9jID0geyBcbiAgICAgICAgLi4ubW9ja1BERkRvY3VtZW50LCBcbiAgICAgICAgY29weVBhZ2VzOiBqZXN0LmZuKCkubW9ja1Jlc29sdmVkVmFsdWUoWydjb3BpZWRQYWdlMScsICdjb3BpZWRQYWdlMicsICdjb3BpZWRQYWdlMyddKSxcbiAgICAgICAgYWRkUGFnZTogamVzdC5mbigpXG4gICAgICB9O1xuXG4gICAgICAoUERGRG9jdW1lbnQubG9hZCBhcyBqZXN0Lk1vY2spXG4gICAgICAgIC5tb2NrUmVzb2x2ZWRWYWx1ZU9uY2UobW9ja0RvYzEpXG4gICAgICAgIC5tb2NrUmVzb2x2ZWRWYWx1ZU9uY2UobW9ja0RvYzIpO1xuICAgICAgKFBERkRvY3VtZW50LmNyZWF0ZSBhcyBqZXN0Lk1vY2spLm1vY2tSZXNvbHZlZFZhbHVlKG1vY2tNZXJnZWREb2MpO1xuICAgICAgXG4gICAgICBjb25zdCBtZXJnZWRCeXRlcyA9IG5ldyBVaW50OEFycmF5KFsxLCAyLCAzLCA0LCA1LCA2XSk7XG4gICAgICBtb2NrTWVyZ2VkRG9jLnNhdmUubW9ja1Jlc29sdmVkVmFsdWUobWVyZ2VkQnl0ZXMpO1xuXG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBwZGZTZXJ2aWNlLm1lcmdlUERGcyhwZGZCdWZmZXJzKTtcblxuICAgICAgZXhwZWN0KFBERkRvY3VtZW50LmxvYWQpLnRvSGF2ZUJlZW5DYWxsZWRUaW1lcygyKTtcbiAgICAgIGV4cGVjdChQREZEb2N1bWVudC5jcmVhdGUpLnRvSGF2ZUJlZW5DYWxsZWQoKTtcbiAgICAgIGV4cGVjdChtb2NrTWVyZ2VkRG9jLmNvcHlQYWdlcykudG9IYXZlQmVlbkNhbGxlZFRpbWVzKDIpO1xuICAgICAgZXhwZWN0KHJlc3VsdCkudG9CZShtZXJnZWRCeXRlcyk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIGhhbmRsZSBtZXJnZSBlcnJvcnMnLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCBwZGZCdWZmZXJzID0gW25ldyBVaW50OEFycmF5KFsxLCAyLCAzXSldO1xuICAgICAgY29uc3QgbG9hZEVycm9yID0gbmV3IEVycm9yKCdMb2FkIGZhaWxlZCcpO1xuICAgICAgXG4gICAgICAoUERGRG9jdW1lbnQubG9hZCBhcyBqZXN0Lk1vY2spLm1vY2tSZWplY3RlZFZhbHVlKGxvYWRFcnJvcik7XG5cbiAgICAgIGF3YWl0IGV4cGVjdChwZGZTZXJ2aWNlLm1lcmdlUERGcyhwZGZCdWZmZXJzKSkucmVqZWN0cy50b1Rocm93KCdMb2FkIGZhaWxlZCcpO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBoYW5kbGUgZW1wdHkgYnVmZmVycyBhcnJheScsIGFzeW5jICgpID0+IHtcbiAgICAgIGF3YWl0IGV4cGVjdChwZGZTZXJ2aWNlLm1lcmdlUERGcyhbXSkpLnJlamVjdHMudG9UaHJvdygpO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgnc3BsaXRQREYnLCAoKSA9PiB7XG4gICAgaXQoJ3Nob3VsZCBzcGxpdCBQREYgYXQgc3BlY2lmaWVkIHBhZ2UnLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCBwZGZCeXRlcyA9IG5ldyBVaW50OEFycmF5KFsxLCAyLCAzLCA0LCA1XSk7XG4gICAgICBjb25zdCBzcGxpdFBhZ2UgPSAzO1xuICAgICAgXG4gICAgICBjb25zdCBtb2NrU291cmNlRG9jID0ge1xuICAgICAgICAuLi5tb2NrUERGRG9jdW1lbnQsXG4gICAgICAgIGdldFBhZ2VDb3VudDogKCkgPT4gNSxcbiAgICAgICAgZ2V0UGFnZXM6ICgpID0+IFsncDEnLCAncDInLCAncDMnLCAncDQnLCAncDUnXVxuICAgICAgfTtcbiAgICAgIFxuICAgICAgY29uc3QgbW9ja0ZpcnN0RG9jID0geyBcbiAgICAgICAgLi4ubW9ja1BERkRvY3VtZW50LFxuICAgICAgICBjb3B5UGFnZXM6IGplc3QuZm4oKS5tb2NrUmVzb2x2ZWRWYWx1ZShbJ3AxJywgJ3AyJywgJ3AzJ10pLFxuICAgICAgICBhZGRQYWdlOiBqZXN0LmZuKCksXG4gICAgICAgIHNhdmU6IGplc3QuZm4oKS5tb2NrUmVzb2x2ZWRWYWx1ZShuZXcgVWludDhBcnJheShbMSwgMiwgM10pKVxuICAgICAgfTtcbiAgICAgIFxuICAgICAgY29uc3QgbW9ja1NlY29uZERvYyA9IHsgXG4gICAgICAgIC4uLm1vY2tQREZEb2N1bWVudCxcbiAgICAgICAgY29weVBhZ2VzOiBqZXN0LmZuKCkubW9ja1Jlc29sdmVkVmFsdWUoWydwNCcsICdwNSddKSxcbiAgICAgICAgYWRkUGFnZTogamVzdC5mbigpLFxuICAgICAgICBzYXZlOiBqZXN0LmZuKCkubW9ja1Jlc29sdmVkVmFsdWUobmV3IFVpbnQ4QXJyYXkoWzQsIDVdKSlcbiAgICAgIH07XG5cbiAgICAgIChQREZEb2N1bWVudC5sb2FkIGFzIGplc3QuTW9jaykubW9ja1Jlc29sdmVkVmFsdWUobW9ja1NvdXJjZURvYyk7XG4gICAgICAoUERGRG9jdW1lbnQuY3JlYXRlIGFzIGplc3QuTW9jaylcbiAgICAgICAgLm1vY2tSZXNvbHZlZFZhbHVlT25jZShtb2NrRmlyc3REb2MpXG4gICAgICAgIC5tb2NrUmVzb2x2ZWRWYWx1ZU9uY2UobW9ja1NlY29uZERvYyk7XG5cbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHBkZlNlcnZpY2Uuc3BsaXRQREYocGRmQnl0ZXMsIHNwbGl0UGFnZSk7XG5cbiAgICAgIGV4cGVjdChyZXN1bHQuZmlyc3QpLnRvRXF1YWwobmV3IFVpbnQ4QXJyYXkoWzEsIDIsIDNdKSk7XG4gICAgICBleHBlY3QocmVzdWx0LnNlY29uZCkudG9FcXVhbChuZXcgVWludDhBcnJheShbNCwgNV0pKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgaGFuZGxlIGludmFsaWQgc3BsaXQgcGFnZScsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IHBkZkJ5dGVzID0gbmV3IFVpbnQ4QXJyYXkoWzEsIDIsIDMsIDQsIDVdKTtcbiAgICAgIGNvbnN0IG1vY2tTb3VyY2VEb2MgPSB7IGdldFBhZ2VDb3VudDogKCkgPT4gNSB9O1xuICAgICAgXG4gICAgICAoUERGRG9jdW1lbnQubG9hZCBhcyBqZXN0Lk1vY2spLm1vY2tSZXNvbHZlZFZhbHVlKG1vY2tTb3VyY2VEb2MpO1xuXG4gICAgICBhd2FpdCBleHBlY3QocGRmU2VydmljZS5zcGxpdFBERihwZGZCeXRlcywgMCkpLnJlamVjdHMudG9UaHJvdygnSW52YWxpZCBzcGxpdCBwYWdlJyk7XG4gICAgICBhd2FpdCBleHBlY3QocGRmU2VydmljZS5zcGxpdFBERihwZGZCeXRlcywgNikpLnJlamVjdHMudG9UaHJvdygnSW52YWxpZCBzcGxpdCBwYWdlJyk7XG4gICAgfSk7XG4gIH0pO1xufSk7XG5cbi8vIENsZWFuIHVwIGFmdGVyIHRlc3RzXG5hZnRlckFsbCgoKSA9PiB7XG4gIGplc3QucmVzdG9yZUFsbE1vY2tzKCk7XG59KTsiXSwidmVyc2lvbiI6M30=