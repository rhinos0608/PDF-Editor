f7864c0af014700ec1b5f49f48f62503
"use strict";
/**
 * PDFService Unit Tests
 * Tests the core PDF manipulation functionality
 */
Object.defineProperty(exports, "__esModule", { value: true });
const PDFService_1 = require("../../../src/renderer/services/PDFService");
describe('PDFService', () => {
    let service;
    let mockPDFData;
    beforeEach(() => {
        service = new PDFService_1.PDFService();
        // Create mock PDF data for testing
        mockPDFData = new ArrayBuffer(1024);
    });
    afterEach(() => {
        jest.clearAllMocks();
    });
    describe('initialization', () => {
        it('should initialize successfully', () => {
            expect(service).toBeDefined();
            expect(typeof service.loadPDF).toBe('function');
            expect(typeof service.savePDF).toBe('function');
        });
    });
    describe('loadPDF', () => {
        it('should reject invalid input', async () => {
            await expect(service.loadPDF(null)).rejects.toThrow();
            await expect(service.loadPDF(undefined)).rejects.toThrow();
            await expect(service.loadPDF('invalid-string')).rejects.toThrow();
        });
        it('should handle empty arrays', async () => {
            const emptyArray = new Uint8Array(0);
            await expect(service.loadPDF(emptyArray)).rejects.toThrow('Empty or invalid PDF data');
        });
        it('should validate PDF header', async () => {
            const invalidPDF = new Uint8Array([1, 2, 3, 4, 5]);
            await expect(service.loadPDF(invalidPDF)).rejects.toThrow('Invalid PDF format');
        });
        it('should accept valid PDF data structure', async () => {
            // Mock valid PDF header
            const validPDFStart = new TextEncoder().encode('%PDF-1.4');
            const mockPDF = new Uint8Array(1024);
            mockPDF.set(validPDFStart, 0);
            // Mock successful PDF loading
            jest.spyOn(service, 'validatePDFFormat').mockReturnValue(true);
            jest.spyOn(service, 'parsePDFDocument').mockResolvedValue({
                numPages: 1,
                getPage: jest.fn(),
                destroy: jest.fn()
            });
            const result = await service.loadPDF(mockPDF);
            expect(result).toBeDefined();
            expect(result.numPages).toBe(1);
        });
    });
    describe('security validation', () => {
        it('should reject oversized files', async () => {
            const oversizedPDF = new Uint8Array(200 * 1024 * 1024); // 200MB
            await expect(service.loadPDF(oversizedPDF)).rejects.toThrow('File too large');
        });
        it('should validate file size limits', () => {
            const service = new PDFService_1.PDFService();
            expect(service.MAX_FILE_SIZE).toBe(100 * 1024 * 1024); // 100MB
        });
        it('should sanitize metadata input', async () => {
            const maliciousMetadata = {
                title: '<script>alert("xss")</script>',
                author: '../../etc/passwd',
                subject: '\x00\x01\x02malformed'
            };
            const sanitized = service.sanitizeMetadata(maliciousMetadata);
            expect(sanitized.title).not.toContain('<script>');
            expect(sanitized.author).not.toContain('../');
            expect(sanitized.subject).not.toContain('\x00');
        });
    });
    describe('error handling', () => {
        it('should handle corrupted PDF gracefully', async () => {
            const corruptedPDF = new Uint8Array(100);
            corruptedPDF.set(new TextEncoder().encode('%PDF-1.4'), 0);
            // Fill rest with garbage data
            for (let i = 8; i < 100; i++) {
                corruptedPDF[i] = Math.floor(Math.random() * 256);
            }
            await expect(service.loadPDF(corruptedPDF)).rejects.toThrow();
        });
        it('should provide meaningful error messages', async () => {
            const invalidPDF = new Uint8Array([1, 2, 3]);
            try {
                await service.loadPDF(invalidPDF);
                fail('Expected error was not thrown');
            }
            catch (error) {
                expect(error.message).toContain('PDF');
                expect(error.message.length).toBeGreaterThan(10);
            }
        });
        it('should handle memory exhaustion', async () => {
            // Mock memory exhaustion scenario
            jest.spyOn(global, 'setTimeout').mockImplementation((cb) => {
                const error = new Error('Maximum call stack size exceeded');
                error.name = 'RangeError';
                throw error;
            });
            const mockPDF = new Uint8Array(1024);
            mockPDF.set(new TextEncoder().encode('%PDF-1.4'), 0);
            await expect(service.loadPDF(mockPDF)).rejects.toThrow();
            jest.restoreAllMocks();
        });
    });
    describe('performance', () => {
        it('should complete PDF loading within reasonable time', async () => {
            const mockPDF = new Uint8Array(1024);
            mockPDF.set(new TextEncoder().encode('%PDF-1.4'), 0);
            jest.spyOn(service, 'validatePDFFormat').mockReturnValue(true);
            jest.spyOn(service, 'parsePDFDocument').mockResolvedValue({
                numPages: 1,
                getPage: jest.fn(),
                destroy: jest.fn()
            });
            const startTime = Date.now();
            await service.loadPDF(mockPDF);
            const endTime = Date.now();
            expect(endTime - startTime).toBeLessThan(5000); // 5 seconds max
        }, 10000);
        it('should handle concurrent loading requests', async () => {
            const mockPDF = new Uint8Array(1024);
            mockPDF.set(new TextEncoder().encode('%PDF-1.4'), 0);
            jest.spyOn(service, 'validatePDFFormat').mockReturnValue(true);
            jest.spyOn(service, 'parsePDFDocument').mockResolvedValue({
                numPages: 1,
                getPage: jest.fn(),
                destroy: jest.fn()
            });
            const promises = Array(5).fill(null).map(() => service.loadPDF(mockPDF));
            const results = await Promise.all(promises);
            expect(results).toHaveLength(5);
            results.forEach(result => {
                expect(result).toBeDefined();
                expect(result.numPages).toBe(1);
            });
        });
    });
    describe('cleanup', () => {
        it('should properly cleanup resources', async () => {
            const mockPDF = new Uint8Array(1024);
            mockPDF.set(new TextEncoder().encode('%PDF-1.4'), 0);
            const mockDocument = {
                numPages: 1,
                getPage: jest.fn(),
                destroy: jest.fn()
            };
            jest.spyOn(service, 'validatePDFFormat').mockReturnValue(true);
            jest.spyOn(service, 'parsePDFDocument').mockResolvedValue(mockDocument);
            const result = await service.loadPDF(mockPDF);
            await service.cleanup();
            expect(mockDocument.destroy).toHaveBeenCalled();
        });
        it('should handle cleanup errors gracefully', async () => {
            jest.spyOn(console, 'error').mockImplementation(() => { });
            const cleanup = service.cleanup();
            expect(cleanup).resolves.not.toThrow();
            jest.restoreAllMocks();
        });
    });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiQzpcXFVzZXJzXFxBZG1pblxcRG9jdW1lbnRzXFxSU1RcXFBERiBFZGl0b3JcXHRlc3RzXFx1bml0XFxzZXJ2aWNlc1xcUERGU2VydmljZS50ZXN0LnRzIiwibWFwcGluZ3MiOiI7QUFBQTs7O0dBR0c7O0FBRUgsMEVBQXVFO0FBSXZFLFFBQVEsQ0FBQyxZQUFZLEVBQUUsR0FBRyxFQUFFO0lBQzFCLElBQUksT0FBbUIsQ0FBQztJQUN4QixJQUFJLFdBQXdCLENBQUM7SUFFN0IsVUFBVSxDQUFDLEdBQUcsRUFBRTtRQUNkLE9BQU8sR0FBRyxJQUFJLHVCQUFVLEVBQUUsQ0FBQztRQUMzQixtQ0FBbUM7UUFDbkMsV0FBVyxHQUFHLElBQUksV0FBVyxDQUFDLElBQUksQ0FBQyxDQUFDO0lBQ3RDLENBQUMsQ0FBQyxDQUFDO0lBRUgsU0FBUyxDQUFDLEdBQUcsRUFBRTtRQUNiLElBQUksQ0FBQyxhQUFhLEVBQUUsQ0FBQztJQUN2QixDQUFDLENBQUMsQ0FBQztJQUVILFFBQVEsQ0FBQyxnQkFBZ0IsRUFBRSxHQUFHLEVBQUU7UUFDOUIsRUFBRSxDQUFDLGdDQUFnQyxFQUFFLEdBQUcsRUFBRTtZQUN4QyxNQUFNLENBQUMsT0FBTyxDQUFDLENBQUMsV0FBVyxFQUFFLENBQUM7WUFDOUIsTUFBTSxDQUFDLE9BQU8sT0FBTyxDQUFDLE9BQU8sQ0FBQyxDQUFDLElBQUksQ0FBQyxVQUFVLENBQUMsQ0FBQztZQUNoRCxNQUFNLENBQUMsT0FBTyxPQUFPLENBQUMsT0FBTyxDQUFDLENBQUMsSUFBSSxDQUFDLFVBQVUsQ0FBQyxDQUFDO1FBQ2xELENBQUMsQ0FBQyxDQUFDO0lBQ0wsQ0FBQyxDQUFDLENBQUM7SUFFSCxRQUFRLENBQUMsU0FBUyxFQUFFLEdBQUcsRUFBRTtRQUN2QixFQUFFLENBQUMsNkJBQTZCLEVBQUUsS0FBSyxJQUFJLEVBQUU7WUFDM0MsTUFBTSxNQUFNLENBQUMsT0FBTyxDQUFDLE9BQU8sQ0FBQyxJQUFXLENBQUMsQ0FBQyxDQUFDLE9BQU8sQ0FBQyxPQUFPLEVBQUUsQ0FB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QUUsQ0FBQztZQUNsQyxNQUFNLENBQUMsT0FBTyxDQUFDLENBQUMsUUFBUSxDQUFDLEdBQUcsQ0FBQyxPQUFPLEVBQUUsQ0FBQztZQUV2QyxJQUFJLENBQUMsZUFBZSxFQUFFLENBQUM7UUFDekIsQ0FBQyxDQUFDLENBQUM7SUFDTCxDQUFDLENBQUMsQ0FBQztBQUNMLENBQUMsQ0FBQyxDQUFDIiwibmFtZXMiOltdLCJzb3VyY2VzIjpbIkM6XFxVc2Vyc1xcQWRtaW5cXERvY3VtZW50c1xcUlNUXFxQREYgRWRpdG9yXFx0ZXN0c1xcdW5pdFxcc2VydmljZXNcXFBERlNlcnZpY2UudGVzdC50cyJdLCJzb3VyY2VzQ29udGVudCI6WyIvKipcbiAqIFBERlNlcnZpY2UgVW5pdCBUZXN0c1xuICogVGVzdHMgdGhlIGNvcmUgUERGIG1hbmlwdWxhdGlvbiBmdW5jdGlvbmFsaXR5XG4gKi9cblxuaW1wb3J0IHsgUERGU2VydmljZSB9IGZyb20gJy4uLy4uLy4uL3NyYy9yZW5kZXJlci9zZXJ2aWNlcy9QREZTZXJ2aWNlJztcbmltcG9ydCAqIGFzIGZzIGZyb20gJ2ZzJztcbmltcG9ydCAqIGFzIHBhdGggZnJvbSAncGF0aCc7XG5cbmRlc2NyaWJlKCdQREZTZXJ2aWNlJywgKCkgPT4ge1xuICBsZXQgc2VydmljZTogUERGU2VydmljZTtcbiAgbGV0IG1vY2tQREZEYXRhOiBBcnJheUJ1ZmZlcjtcblxuICBiZWZvcmVFYWNoKCgpID0+IHtcbiAgICBzZXJ2aWNlID0gbmV3IFBERlNlcnZpY2UoKTtcbiAgICAvLyBDcmVhdGUgbW9jayBQREYgZGF0YSBmb3IgdGVzdGluZ1xuICAgIG1vY2tQREZEYXRhID0gbmV3IEFycmF5QnVmZmVyKDEwMjQpO1xuICB9KTtcblxuICBhZnRlckVhY2goKCkgPT4ge1xuICAgIGplc3QuY2xlYXJBbGxNb2NrcygpO1xuICB9KTtcblxuICBkZXNjcmliZSgnaW5pdGlhbGl6YXRpb24nLCAoKSA9PiB7XG4gICAgaXQoJ3Nob3VsZCBpbml0aWFsaXplIHN1Y2Nlc3NmdWxseScsICgpID0+IHtcbiAgICAgIGV4cGVjdChzZXJ2aWNlKS50b0JlRGVmaW5lZCgpO1xuICAgICAgZXhwZWN0KHR5cGVvZiBzZXJ2aWNlLmxvYWRQREYpLnRvQmUoJ2Z1bmN0aW9uJyk7XG4gICAgICBleHBlY3QodHlwZW9mIHNlcnZpY2Uuc2F2ZVBERikudG9CZSgnZnVuY3Rpb24nKTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ2xvYWRQREYnLCAoKSA9PiB7XG4gICAgaXQoJ3Nob3VsZCByZWplY3QgaW52YWxpZCBpbnB1dCcsIGFzeW5jICgpID0+IHtcbiAgICAgIGF3YWl0IGV4cGVjdChzZXJ2aWNlLmxvYWRQREYobnVsbCBhcyBhbnkpKS5yZWplY3RzLnRvVGhyb3coKTtcbiAgICAgIGF3YWl0IGV4cGVjdChzZXJ2aWNlLmxvYWRQREYodW5kZWZpbmVkIGFzIGFueSkpLnJlamVjdHMudG9UaHJvdygpO1xuICAgICAgYXdhaXQgZXhwZWN0KHNlcnZpY2UubG9hZFBERignaW52YWxpZC1zdHJpbmcnIGFzIGFueSkpLnJlamVjdHMudG9UaHJvdygpO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBoYW5kbGUgZW1wdHkgYXJyYXlzJywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgZW1wdHlBcnJheSA9IG5ldyBVaW50OEFycmF5KDApO1xuICAgICAgYXdhaXQgZXhwZWN0KHNlcnZpY2UubG9hZFBERihlbXB0eUFycmF5KSkucmVqZWN0cy50b1Rocm93KCdFbXB0eSBvciBpbnZhbGlkIFBERiBkYXRhJyk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIHZhbGlkYXRlIFBERiBoZWFkZXInLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCBpbnZhbGlkUERGID0gbmV3IFVpbnQ4QXJyYXkoWzEsIDIsIDMsIDQsIDVdKTtcbiAgICAgIGF3YWl0IGV4cGVjdChzZXJ2aWNlLmxvYWRQREYoaW52YWxpZFBERikpLnJlamVjdHMudG9UaHJvdygnSW52YWxpZCBQREYgZm9ybWF0Jyk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIGFjY2VwdCB2YWxpZCBQREYgZGF0YSBzdHJ1Y3R1cmUnLCBhc3luYyAoKSA9PiB7XG4gICAgICAvLyBNb2NrIHZhbGlkIFBERiBoZWFkZXJcbiAgICAgIGNvbnN0IHZhbGlkUERGU3RhcnQgPSBuZXcgVGV4dEVuY29kZXIoKS5lbmNvZGUoJyVQREYtMS40Jyk7XG4gICAgICBjb25zdCBtb2NrUERGID0gbmV3IFVpbnQ4QXJyYXkoMTAyNCk7XG4gICAgICBtb2NrUERGLnNldCh2YWxpZFBERlN0YXJ0LCAwKTtcbiAgICAgIFxuICAgICAgLy8gTW9jayBzdWNjZXNzZnVsIFBERiBsb2FkaW5nXG4gICAgICBqZXN0LnNweU9uKHNlcnZpY2UgYXMgYW55LCAndmFsaWRhdGVQREZGb3JtYXQnKS5tb2NrUmV0dXJuVmFsdWUodHJ1ZSk7XG4gICAgICBqZXN0LnNweU9uKHNlcnZpY2UgYXMgYW55LCAncGFyc2VQREZEb2N1bWVudCcpLm1vY2tSZXNvbHZlZFZhbHVlKHtcbiAgICAgICAgbnVtUGFnZXM6IDEsXG4gICAgICAgIGdldFBhZ2U6IGplc3QuZm4oKSxcbiAgICAgICAgZGVzdHJveTogamVzdC5mbigpXG4gICAgICB9KTtcblxuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgc2VydmljZS5sb2FkUERGKG1vY2tQREYpO1xuICAgICAgZXhwZWN0KHJlc3VsdCkudG9CZURlZmluZWQoKTtcbiAgICAgIGV4cGVjdChyZXN1bHQubnVtUGFnZXMpLnRvQmUoMSk7XG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdzZWN1cml0eSB2YWxpZGF0aW9uJywgKCkgPT4ge1xuICAgIGl0KCdzaG91bGQgcmVqZWN0IG92ZXJzaXplZCBmaWxlcycsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IG92ZXJzaXplZFBERiA9IG5ldyBVaW50OEFycmF5KDIwMCAqIDEwMjQgKiAxMDI0KTsgLy8gMjAwTUJcbiAgICAgIGF3YWl0IGV4cGVjdChzZXJ2aWNlLmxvYWRQREYob3ZlcnNpemVkUERGKSkucmVqZWN0cy50b1Rocm93KCdGaWxlIHRvbyBsYXJnZScpO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCB2YWxpZGF0ZSBmaWxlIHNpemUgbGltaXRzJywgKCkgPT4ge1xuICAgICAgY29uc3Qgc2VydmljZSA9IG5ldyBQREZTZXJ2aWNlKCk7XG4gICAgICBleHBlY3QoKHNlcnZpY2UgYXMgYW55KS5NQVhfRklMRV9TSVpFKS50b0JlKDEwMCAqIDEwMjQgKiAxMDI0KTsgLy8gMTAwTUJcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgc2FuaXRpemUgbWV0YWRhdGEgaW5wdXQnLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCBtYWxpY2lvdXNNZXRhZGF0YSA9IHtcbiAgICAgICAgdGl0bGU6ICc8c2NyaXB0PmFsZXJ0KFwieHNzXCIpPC9zY3JpcHQ+JyxcbiAgICAgICAgYXV0aG9yOiAnLi4vLi4vZXRjL3Bhc3N3ZCcsXG4gICAgICAgIHN1YmplY3Q6ICdcXHgwMFxceDAxXFx4MDJtYWxmb3JtZWQnXG4gICAgICB9O1xuXG4gICAgICBjb25zdCBzYW5pdGl6ZWQgPSAoc2VydmljZSBhcyBhbnkpLnNhbml0aXplTWV0YWRhdGEobWFsaWNpb3VzTWV0YWRhdGEpO1xuICAgICAgZXhwZWN0KHNhbml0aXplZC50aXRsZSkubm90LnRvQ29udGFpbignPHNjcmlwdD4nKTtcbiAgICAgIGV4cGVjdChzYW5pdGl6ZWQuYXV0aG9yKS5ub3QudG9Db250YWluKCcuLi8nKTtcbiAgICAgIGV4cGVjdChzYW5pdGl6ZWQuc3ViamVjdCkubm90LnRvQ29udGFpbignXFx4MDAnKTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ2Vycm9yIGhhbmRsaW5nJywgKCkgPT4ge1xuICAgIGl0KCdzaG91bGQgaGFuZGxlIGNvcnJ1cHRlZCBQREYgZ3JhY2VmdWxseScsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IGNvcnJ1cHRlZFBERiA9IG5ldyBVaW50OEFycmF5KDEwMCk7XG4gICAgICBjb3JydXB0ZWRQREYuc2V0KG5ldyBUZXh0RW5jb2RlcigpLmVuY29kZSgnJVBERi0xLjQnKSwgMCk7XG4gICAgICAvLyBGaWxsIHJlc3Qgd2l0aCBnYXJiYWdlIGRhdGFcbiAgICAgIGZvciAobGV0IGkgPSA4OyBpIDwgMTAwOyBpKyspIHtcbiAgICAgICAgY29ycnVwdGVkUERGW2ldID0gTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogMjU2KTtcbiAgICAgIH1cblxuICAgICAgYXdhaXQgZXhwZWN0KHNlcnZpY2UubG9hZFBERihjb3JydXB0ZWRQREYpKS5yZWplY3RzLnRvVGhyb3coKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgcHJvdmlkZSBtZWFuaW5nZnVsIGVycm9yIG1lc3NhZ2VzJywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgaW52YWxpZFBERiA9IG5ldyBVaW50OEFycmF5KFsxLCAyLCAzXSk7XG4gICAgICBcbiAgICAgIHRyeSB7XG4gICAgICAgIGF3YWl0IHNlcnZpY2UubG9hZFBERihpbnZhbGlkUERGKTtcbiAgICAgICAgZmFpbCgnRXhwZWN0ZWQgZXJyb3Igd2FzIG5vdCB0aHJvd24nKTtcbiAgICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgIGV4cGVjdChlcnJvci5tZXNzYWdlKS50b0NvbnRhaW4oJ1BERicpO1xuICAgICAgICBleHBlY3QoZXJyb3IubWVzc2FnZS5sZW5ndGgpLnRvQmVHcmVhdGVyVGhhbigxMCk7XG4gICAgICB9XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIGhhbmRsZSBtZW1vcnkgZXhoYXVzdGlvbicsIGFzeW5jICgpID0+IHtcbiAgICAgIC8vIE1vY2sgbWVtb3J5IGV4aGF1c3Rpb24gc2NlbmFyaW9cbiAgICAgIGplc3Quc3B5T24oZ2xvYmFsLCAnc2V0VGltZW91dCcpLm1vY2tJbXBsZW1lbnRhdGlvbigoY2I6IGFueSkgPT4ge1xuICAgICAgICBjb25zdCBlcnJvciA9IG5ldyBFcnJvcignTWF4aW11bSBjYWxsIHN0YWNrIHNpemUgZXhjZWVkZWQnKTtcbiAgICAgICAgZXJyb3IubmFtZSA9ICdSYW5nZUVycm9yJztcbiAgICAgICAgdGhyb3cgZXJyb3I7XG4gICAgICB9KTtcblxuICAgICAgY29uc3QgbW9ja1BERiA9IG5ldyBVaW50OEFycmF5KDEwMjQpO1xuICAgICAgbW9ja1BERi5zZXQobmV3IFRleHRFbmNvZGVyKCkuZW5jb2RlKCclUERGLTEuNCcpLCAwKTtcblxuICAgICAgYXdhaXQgZXhwZWN0KHNlcnZpY2UubG9hZFBERihtb2NrUERGKSkucmVqZWN0cy50b1Rocm93KCk7XG4gICAgICBcbiAgICAgIGplc3QucmVzdG9yZUFsbE1vY2tzKCk7XG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdwZXJmb3JtYW5jZScsICgpID0+IHtcbiAgICBpdCgnc2hvdWxkIGNvbXBsZXRlIFBERiBsb2FkaW5nIHdpdGhpbiByZWFzb25hYmxlIHRpbWUnLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCBtb2NrUERGID0gbmV3IFVpbnQ4QXJyYXkoMTAyNCk7XG4gICAgICBtb2NrUERGLnNldChuZXcgVGV4dEVuY29kZXIoKS5lbmNvZGUoJyVQREYtMS40JyksIDApO1xuICAgICAgXG4gICAgICBqZXN0LnNweU9uKHNlcnZpY2UgYXMgYW55LCAndmFsaWRhdGVQREZGb3JtYXQnKS5tb2NrUmV0dXJuVmFsdWUodHJ1ZSk7XG4gICAgICBqZXN0LnNweU9uKHNlcnZpY2UgYXMgYW55LCAncGFyc2VQREZEb2N1bWVudCcpLm1vY2tSZXNvbHZlZFZhbHVlKHtcbiAgICAgICAgbnVtUGFnZXM6IDEsXG4gICAgICAgIGdldFBhZ2U6IGplc3QuZm4oKSxcbiAgICAgICAgZGVzdHJveTogamVzdC5mbigpXG4gICAgICB9KTtcblxuICAgICAgY29uc3Qgc3RhcnRUaW1lID0gRGF0ZS5ub3coKTtcbiAgICAgIGF3YWl0IHNlcnZpY2UubG9hZFBERihtb2NrUERGKTtcbiAgICAgIGNvbnN0IGVuZFRpbWUgPSBEYXRlLm5vdygpO1xuICAgICAgXG4gICAgICBleHBlY3QoZW5kVGltZSAtIHN0YXJ0VGltZSkudG9CZUxlc3NUaGFuKDUwMDApOyAvLyA1IHNlY29uZHMgbWF4XG4gICAgfSwgMTAwMDApO1xuXG4gICAgaXQoJ3Nob3VsZCBoYW5kbGUgY29uY3VycmVudCBsb2FkaW5nIHJlcXVlc3RzJywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgbW9ja1BERiA9IG5ldyBVaW50OEFycmF5KDEwMjQpO1xuICAgICAgbW9ja1BERi5zZXQobmV3IFRleHRFbmNvZGVyKCkuZW5jb2RlKCclUERGLTEuNCcpLCAwKTtcbiAgICAgIFxuICAgICAgamVzdC5zcHlPbihzZXJ2aWNlIGFzIGFueSwgJ3ZhbGlkYXRlUERGRm9ybWF0JykubW9ja1JldHVyblZhbHVlKHRydWUpO1xuICAgICAgamVzdC5zcHlPbihzZXJ2aWNlIGFzIGFueSwgJ3BhcnNlUERGRG9jdW1lbnQnKS5tb2NrUmVzb2x2ZWRWYWx1ZSh7XG4gICAgICAgIG51bVBhZ2VzOiAxLFxuICAgICAgICBnZXRQYWdlOiBqZXN0LmZuKCksXG4gICAgICAgIGRlc3Ryb3k6IGplc3QuZm4oKVxuICAgICAgfSk7XG5cbiAgICAgIGNvbnN0IHByb21pc2VzID0gQXJyYXkoNSkuZmlsbChudWxsKS5tYXAoKCkgPT4gc2VydmljZS5sb2FkUERGKG1vY2tQREYpKTtcbiAgICAgIGNvbnN0IHJlc3VsdHMgPSBhd2FpdCBQcm9taXNlLmFsbChwcm9taXNlcyk7XG4gICAgICBcbiAgICAgIGV4cGVjdChyZXN1bHRzKS50b0hhdmVMZW5ndGgoNSk7XG4gICAgICByZXN1bHRzLmZvckVhY2gocmVzdWx0ID0+IHtcbiAgICAgICAgZXhwZWN0KHJlc3VsdCkudG9CZURlZmluZWQoKTtcbiAgICAgICAgZXhwZWN0KHJlc3VsdC5udW1QYWdlcykudG9CZSgxKTtcbiAgICAgIH0pO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgnY2xlYW51cCcsICgpID0+IHtcbiAgICBpdCgnc2hvdWxkIHByb3Blcmx5IGNsZWFudXAgcmVzb3VyY2VzJywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgbW9ja1BERiA9IG5ldyBVaW50OEFycmF5KDEwMjQpO1xuICAgICAgbW9ja1BERi5zZXQobmV3IFRleHRFbmNvZGVyKCkuZW5jb2RlKCclUERGLTEuNCcpLCAwKTtcbiAgICAgIFxuICAgICAgY29uc3QgbW9ja0RvY3VtZW50ID0ge1xuICAgICAgICBudW1QYWdlczogMSxcbiAgICAgICAgZ2V0UGFnZTogamVzdC5mbigpLFxuICAgICAgICBkZXN0cm95OiBqZXN0LmZuKClcbiAgICAgIH07XG4gICAgICBcbiAgICAgIGplc3Quc3B5T24oc2VydmljZSBhcyBhbnksICd2YWxpZGF0ZVBERkZvcm1hdCcpLm1vY2tSZXR1cm5WYWx1ZSh0cnVlKTtcbiAgICAgIGplc3Quc3B5T24oc2VydmljZSBhcyBhbnksICdwYXJzZVBERkRvY3VtZW50JykubW9ja1Jlc29sdmVkVmFsdWUobW9ja0RvY3VtZW50KTtcblxuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgc2VydmljZS5sb2FkUERGKG1vY2tQREYpO1xuICAgICAgYXdhaXQgc2VydmljZS5jbGVhbnVwKCk7XG4gICAgICBcbiAgICAgIGV4cGVjdChtb2NrRG9jdW1lbnQuZGVzdHJveSkudG9IYXZlQmVlbkNhbGxlZCgpO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBoYW5kbGUgY2xlYW51cCBlcnJvcnMgZ3JhY2VmdWxseScsIGFzeW5jICgpID0+IHtcbiAgICAgIGplc3Quc3B5T24oY29uc29sZSwgJ2Vycm9yJykubW9ja0ltcGxlbWVudGF0aW9uKCgpID0+IHt9KTtcbiAgICAgIFxuICAgICAgY29uc3QgY2xlYW51cCA9IHNlcnZpY2UuY2xlYW51cCgpO1xuICAgICAgZXhwZWN0KGNsZWFudXApLnJlc29sdmVzLm5vdC50b1Rocm93KCk7XG4gICAgICBcbiAgICAgIGplc3QucmVzdG9yZUFsbE1vY2tzKCk7XG4gICAgfSk7XG4gIH0pO1xufSk7Il0sInZlcnNpb24iOjN9